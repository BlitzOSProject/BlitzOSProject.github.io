<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns:css="http://macVmlSchemaUri" xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta name=Title content="proj 1">
<meta name=Keywords content="">
<meta http-equiv=Content-Type content="text/html; charset=macintosh">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 2008">
<meta name=Originator content="Microsoft Word 2008">
<link rel=File-List href="proj7_files/filelist.xml">
<title>proj 1</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Harry H. Porter III</o:Author>
  <o:Template>Normal.dotm</o:Template>
  <o:LastAuthor>Harry</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>9214</o:TotalTime>
  <o:LastPrinted>2009-03-26T01:20:00Z</o:LastPrinted>
  <o:Created>2009-03-26T01:20:00Z</o:Created>
  <o:LastSaved>2009-03-26T01:20:00Z</o:LastSaved>
  <o:Pages>2</o:Pages>
  <o:Words>2257</o:Words>
  <o:Characters>11513</o:Characters>
  <o:Lines>442</o:Lines>
  <o:Paragraphs>217</o:Paragraphs>
  <o:CharactersWithSpaces>15802</o:CharactersWithSpaces>
  <o:Version>12.0</o:Version>
 </o:DocumentProperties>
 <o:OfficeDocumentSettings>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:ActiveWritingStyle Lang="EN-US" VendorID="6" DLLVersion="2" NLCheck="0">1</w:ActiveWritingStyle>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:HyphenationZone>0</w:HyphenationZone>
  <w:DoNotHyphenateCaps/>
  <w:DrawingGridHorizontalSpacing>0 pt</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>0 pt</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>0</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:ValidateAgainstSchemas>false</w:ValidateAgainstSchemas>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotUnderlineInvalidXML/>
  <w:DrawingGridHorizontalOrigin>0 pt</w:DrawingGridHorizontalOrigin>
  <w:DrawingGridVerticalOrigin>0 pt</w:DrawingGridVerticalOrigin>
  <w:DoNotShadeFormData/>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:UseNormalStyleForList/>
   <w:DontUseIndentAsNumberingTabStop/>
   <w:DontGrowAutofit/>
   <w:FELineBreak11/>
   <w:WW11IndentRules/>
   <w:DontAutofitConstrainedTables/>
   <w:AutofitLikeWW11/>
   <w:HangulWidthLikeWW11/>
  </w:Compatibility>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="276">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:"Courier New";
	panose-1:2 7 3 9 2 2 5 2 4 4;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Times;
	panose-1:2 0 5 0 0 0 0 0 0 0;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:"New York";
	panose-1:2 2 5 2 6 3 5 6 2 4;
	mso-font-charset:77;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	text-align:justify;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-hansi-font-family:Times;
	mso-font-kerning:0pt;
	text-decoration:underline;
	text-underline:single;}
h2
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-hansi-font-family:Times;
	text-decoration:underline;
	text-underline:single;}
h3
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:14.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-hansi-font-family:Times;
	text-decoration:underline;
	text-underline:single;}
h4
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:4;
	font-size:20.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-hansi-font-family:Times;}
h5
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:5;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Courier New";
	mso-hansi-font-family:"Courier New";}
h6
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:none;
	page-break-after:avoid;
	mso-outline-level:6;
	mso-layout-grid-align:none;
	text-autospace:none;
	font-size:14.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-hansi-font-family:Times;
	color:black;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 3.0in right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 3.0in right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{margin:0in;
	margin-bottom:.0001pt;
	text-align:justify;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
p.MsoBodyTextIndent, li.MsoBodyTextIndent, div.MsoBodyTextIndent
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.25in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
p.MsoBodyText2, li.MsoBodyText2, div.MsoBodyText2
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
p.MsoBodyText3, li.MsoBodyText3, div.MsoBodyText3
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
p.MsoBodyTextIndent2, li.MsoBodyTextIndent2, div.MsoBodyTextIndent2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-noshow:yes;
	color:purple;
	text-decoration:underline;
	text-underline:single;}
 /* Page Definitions */
@page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in .75in 1.0in .75in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-header:url(":proj7_files:header.htm") h1;
	mso-footer:url(":proj7_files:header.htm") f1;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"New York";
	mso-hansi-font-family:"New York";}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'><b style='mso-bidi-font-weight:
normal'><span style='font-size:20.0pt;mso-bidi-font-size:10.0pt'>Programming
Project 7:<o:p></o:p></span></b></p>

<h4>File-Related Syscalls</h4>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-align:justify'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-align:justify'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-align:justify'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><u><span
style='font-size:14.0pt;mso-bidi-font-size:10.0pt'>Due Date:</span></u></b><span
style='font-size:14.0pt;mso-bidi-font-size:10.0pt'> </span>______________________________</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><u><span
style='font-size:14.0pt;mso-bidi-font-size:10.0pt'>Project Duration:</span></u></b><span
style='font-size:14.0pt;mso-bidi-font-size:10.0pt'><span style="mso-spacerun:
yes">&nbsp; </span></span>One week</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h3>Overview and Goal</h3>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In this project, you will implement the syscalls relating to
file I/O: <b style='mso-bidi-font-weight:normal'>Open</b>, <b style='mso-bidi-font-weight:
normal'>Read</b>, <b style='mso-bidi-font-weight:normal'>Write</b>, <b
style='mso-bidi-font-weight:normal'>Seek</b>, and <b style='mso-bidi-font-weight:
normal'>Close</b>.<span style="mso-spacerun: yes">&nbsp; </span>These syscalls
will allow user-level processes to read and write to files stored on the BLITZ
DISK file.<span style="mso-spacerun: yes">&nbsp; </span>The goal is for you to
understand the syscall mechanism in more detail, to understand what happens
when several processes operate on a shared file system, and to understand how
the kernel buffers and moves data between the file system on the disk and the
user-level processes.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>Download New Files</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The files for this project are available in:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b
style='mso-bidi-font-weight:normal'><span style='font-family:Courier'>http://www.cs.pdx.edu/~harry/Blitz/OSProject/p7/</span></b><span
style='font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The following files are new to this project:</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><a
name="OLE_LINK1">TestProgram4</a>.h<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>TestProgram4.c<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>Program1.h<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>Program1.c<o:p></o:p></span></b></p>

<h5><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>Program2.h</h5>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>Program2.c<o:p></o:p></span></b></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The following files have been modified from the last
project:</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>makefile<o:p></o:p></span></b></p>

<p class=MsoNormal><span style='font-family:"Courier New"'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><b style='mso-bidi-font-weight:
normal'>DISK<o:p></o:p></b></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <b style='mso-bidi-font-weight:normal'>makefile</b> has
been modified to compile <b style='mso-bidi-font-weight:normal'>TestProgram4</b>,
<b style='mso-bidi-font-weight:normal'>Program1</b>, and <b style='mso-bidi-font-weight:
normal'>Program2</b>.<span style="mso-spacerun: yes">&nbsp; </span>The <b
style='mso-bidi-font-weight:normal'>DISK</b> file has been enlarged, since the
previous version was too small to accommodate <b style='mso-bidi-font-weight:
normal'>TestProgram4</b>, <b style='mso-bidi-font-weight:normal'>Program1</b>,
and <b style='mso-bidi-font-weight:normal'>Program2</b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>All remaining files are unchanged from the last project.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>The Task:</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Implement the following syscalls:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Read<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Write<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Seek<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Close<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Update your code as necessary to
account for the possibility of open files.<span style="mso-spacerun:
yes">&nbsp; </span>You’ll probably need to modify these routines, too:</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Handle_Sys_Fork<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ProcessFinish<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Note that files may be open in a
process that invokes the <b style='mso-bidi-font-weight:normal'>Exec</b> syscall.<span
style="mso-spacerun: yes">&nbsp; </span>These files should remain open in the
process after the <b style='mso-bidi-font-weight:normal'>Exec</b> completes
successfully.<span style="mso-spacerun: yes">&nbsp; </span>Does this require a
change to your code?</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Take a look at the project 5 document
for details on the specifications of each of these syscalls.<span
style="mso-spacerun: yes">&nbsp; </span>Please re-read that document
thoroughly.<span style="mso-spacerun: yes">&nbsp; </span>In particular, the
following sections of that document contain important information that you’ll
need to complete this project.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The
“Stub” File System<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The
“diskUtil” Tool<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The
FileManager<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>FileControlBlock
(FCB) and OpenFile<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>Limitations to the “Stub” Filesystem:</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>New files cannot be added to the disk.<span
style="mso-spacerun: yes">&nbsp; </span>We will not implement the <b
style='mso-bidi-font-weight:normal'>Create</b> syscall in this project.<span
style="mso-spacerun: yes">&nbsp; </span>All files must already be on the DISK
before they can be opened and accessed.<span style="mso-spacerun: yes">&nbsp;
</span>(Files can be added to the BLITZ DISK with the <b style='mso-bidi-font-weight:
normal'>diskUtil</b> command.)</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Also, we will not be able to change
the size of a file.<span style="mso-spacerun: yes">&nbsp; </span>If the
user-level program invokes <b style='mso-bidi-font-weight:normal'>Write</b>
with arguments that would cause the bytes transferred to be beyond the current
end of the file, the bytes that are not before the file end should be
transferred, but the bytes beyond the file end will not be transferred.<span
style="mso-spacerun: yes">&nbsp; </span>The <b style='mso-bidi-font-weight:
normal'>Write</b> will return the number of bytes successfully written.<span
style="mso-spacerun: yes">&nbsp; </span>For example, if the file size is 10 and
<b style='mso-bidi-font-weight:normal'>Write</b> is invoked with a length of 5
on a file whose current position is 7, then 3 bytes should be transferred and
the 2 bytes beyond the end of the file will not be transferred.<span
style="mso-spacerun: yes">&nbsp; </span>The <b style='mso-bidi-font-weight:
normal'>Write</b> should return 3.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>Implementing Handle-Sys-Open:</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>Here are some actions you’ll need to take when to
implementing the <b style='mso-bidi-font-weight:normal'>Open</b> syscall:</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Copy
the filename string from virtual space to a small buffer in this routine.</p>

<p class=MsoFooter style='tab-stops:.5in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Make
sure the length of the filename does not exceed MAX_STRING_SIZE</p>

<p class=MsoFooter style='tab-stops:.5in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Locate
an empty slot in this process’s <b style='mso-bidi-font-weight:normal'>fileDescriptor</b>
array.</p>

<p class=MsoFooter style='tab-stops:.5in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>If
there are no empty slots, return &#8211;1.</p>

<p class=MsoFooter style='tab-stops:.5in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Allocate
an <b style='mso-bidi-font-weight:normal'>OpenFile</b> object (see <b
style='mso-bidi-font-weight:normal'>FileManager.Open</b>).</p>

<p class=MsoFooter style='tab-stops:.5in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>If
this fails, return &#8211;1.</p>

<p class=MsoFooter style='tab-stops:.5in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Set
the entry in the <b style='mso-bidi-font-weight:normal'>fileDescriptor</b>
array to point to the <b style='mso-bidi-font-weight:normal'>OpenFile</b>
object.</p>

<p class=MsoFooter style='tab-stops:.5in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Return
the index of the <b style='mso-bidi-font-weight:normal'>fileDescriptor</b>
array element.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>Suggestions Concerning the Algorithm For Handle-Sys-Read:</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>Here is a possible approach to implementing the <b
style='mso-bidi-font-weight:normal'>Read</b> syscall.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>You’ll need to begin by checking that the <b
style='mso-bidi-font-weight:normal'>fileDesc</b> argument really is valid.<span
style="mso-spacerun: yes">&nbsp; </span>The user must provide a legal index
into the <b style='mso-bidi-font-weight:normal'>fileDescriptor</b> array and
the file referenced must have been previously opened.<span style="mso-spacerun:
yes">&nbsp; </span>If not, the <b style='mso-bidi-font-weight:normal'>Read</b>
syscall should return &#8211;1.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>You’ll also need to check that the requested number of bytes
(the <b style='mso-bidi-font-weight:normal'>sizeInBytes</b> argument) is not
negative.<span style="mso-spacerun: yes">&nbsp; </span>If it is, then return
&#8211;1.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>We’ll discuss problems related to the <b style='mso-bidi-font-weight:
normal'>buffer</b> argument later.</p>

<p class=MsoFooter><span style="mso-spacerun: yes">&nbsp;</span></p>

<p class=MsoFooter>When a user-level program invokes the <b style='mso-bidi-font-weight:
normal'>Read</b> syscall, it asks for a sequence of bytes to be fetched from a
file on disk.<span style="mso-spacerun: yes">&nbsp; </span>Unfortunately, this
sequence may span several sectors in the disk file, so several calls to <b
style='mso-bidi-font-weight:normal'>DiskDriver.SynchReadSector</b> will be needed
to read all the data.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>Each call to <b style='mso-bidi-font-weight:normal'>DiskDriver.SynchReadSector</b>
will read an entire 8K sector from the disk into memory.<span
style="mso-spacerun: yes">&nbsp; </span>The caller will provide the address of
where in memory to read the sector, which we can refer to as the “sector
buffer” area in memory.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>The data requested by the user-level process will not
necessarily begin or end on a sector boundary.<span style="mso-spacerun:
yes">&nbsp; </span>So some buffering and movement of the data will be
necessary.<span style="mso-spacerun: yes">&nbsp; </span>Take a look at <b
style='mso-bidi-font-weight:normal'>FileManager.SynchRead</b>, which will
perform a lot of the work you’ll need to do when implementing the <b
style='mso-bidi-font-weight:normal'>Read</b> syscall.<span style="mso-spacerun:
yes">&nbsp; </span>In particular, it will call <b style='mso-bidi-font-weight:
normal'>DiskDriver.SynchReadSector</b> to read a sector into the sector buffer
and then it will copy the desired bytes from the sector buffer to wherever they
should go.<span style="mso-spacerun: yes">&nbsp; </span>(This is called the “target
address.”)</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>Each <b style='mso-bidi-font-weight:normal'>FileControlBlock</b>
already has a sector buffer associated with it.<span style="mso-spacerun:
yes">&nbsp; </span>This is an 8K memory region that was allocated from the pool
of memory frames when the <b style='mso-bidi-font-weight:normal'>FileManager</b>
was initialized.<span style="mso-spacerun: yes">&nbsp; </span>[You do not need
to allocate any memory buffers in this project.]</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>If the requested sequence of bytes spans several sectors, <b
style='mso-bidi-font-weight:normal'>FileManager.SynchRead</b> will read as many
sectors as necessary (re-using the one sector buffer) and, after each disk I/O
completes, it will copy bytes in several chunks to the target area.<span
style="mso-spacerun: yes">&nbsp; </span>(Also, if the sector buffer is dirty
before it starts, it will first write the old sector out to disk.)</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>When a user requests a sequence of bytes to be read from a
file, the user provides a pointer to a “user-space target area,” which tells
the kernel where to copy this data to.<span style="mso-spacerun: yes">&nbsp;
</span>User-level code often refers to its target area as a “buffer” but be
careful to avoid confusing this area with the “sector buffer,” which is part of
the <b style='mso-bidi-font-weight:normal'>FileControlBlock</b> in kernel
space.<span style="mso-spacerun: yes">&nbsp; </span>The user will supply a
virtual address for the user target area by supplying values called <b
style='mso-bidi-font-weight:normal'>buffer</b> and <b style='mso-bidi-font-weight:
normal'>sizeInBytes</b> to the <b style='mso-bidi-font-weight:normal'>Read</b>
syscall.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>When implementing the <b style='mso-bidi-font-weight:normal'>Read</b>
syscall, you’ll need to translate the target address from a virtual address
into a physical address, so you can know where in memory to move the data.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>Unfortunately, the user target area may cross page
boundaries in the virtual address space.<span style="mso-spacerun: yes">&nbsp;
</span>In general, the pages of the user’s address space will not be in
contiguous memory frames.<span style="mso-spacerun: yes">&nbsp; </span><b
style='mso-bidi-font-weight:normal'>FileManager.SynchRead</b> cannot deal with
this; it expects its target area to be one contiguous region in memory.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>This means that you cannot simply call <b style='mso-bidi-font-weight:
normal'>FileManager.SynchRead</b> once to get the job done.<span
style="mso-spacerun: yes">&nbsp; </span>You’ll need to break the user target
area into chunks such that each chunk is entirely within one page.<span
style="mso-spacerun: yes">&nbsp; </span>Then, you can call <b style='mso-bidi-font-weight:
normal'>FileManager.SynchRead</b> to read each of these chunks in a loop.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>Below is some pseudo-code showing how this loop might
work.<span style="mso-spacerun: yes">&nbsp; </span>It works by breaking the
entire sequence of bytes to be read into several chunks.<span
style="mso-spacerun: yes">&nbsp; </span>Each chunk is entirely on one page and
does not cross a page boundary.<span style="mso-spacerun: yes">&nbsp; </span>It
computes the length and starting address of each chunk.<span
style="mso-spacerun: yes">&nbsp; </span>It translates the starting address into
a physical address.<span style="mso-spacerun: yes">&nbsp; </span>Then it calls <b
style='mso-bidi-font-weight:normal'>FileManager.SynchRead</b> to read the chunk
and moves on the next chunk.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>The key variables are:</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='margin-left:.5in;tab-stops:117.0pt center 3.0in right 6.0in'><b
style='mso-bidi-font-weight:normal'>virtPage</b><span style='mso-tab-count:
1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Virtual
address into which to read the next chunk (virtual address page number)</p>

<p class=MsoFooter style='margin-left:.5in;tab-stops:117.0pt center 3.0in right 6.0in'><b
style='mso-bidi-font-weight:normal'>offset</b><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Virtual
address into which to read the next chunk (offset into the page)</p>

<p class=MsoFooter style='margin-left:.5in;tab-stops:117.0pt center 3.0in right 6.0in'><b
style='mso-bidi-font-weight:normal'>chunkSize</b><span style='mso-tab-count:
1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The number of bytes
to be read for this chunk</p>

<p class=MsoFooter style='margin-left:.5in;tab-stops:117.0pt center 3.0in right 6.0in'><b
style='mso-bidi-font-weight:normal'>nextPosInFile</b><span style='mso-tab-count:
1'>&nbsp;&nbsp; </span>The position in the file from which to read the next
chunk</p>

<p class=MsoFooter style='margin-left:.5in;tab-stops:117.0pt center 3.0in right 6.0in'><b
style='mso-bidi-font-weight:normal'>copiedSoFar</b><span style='mso-tab-count:
1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>The number of bytes read from disk so far</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>At the beginning of each loop iteration, <b
style='mso-bidi-font-weight:normal'>virtPage</b> and <b style='mso-bidi-font-weight:
normal'>offset </b>tell where the first byte in the next chunk should go.<span
style="mso-spacerun: yes">&nbsp; </span>Each iteration computes the size of the
next chunk, does the read, and then adjusts all the variables.<span
style="mso-spacerun: yes">&nbsp; </span><b style='mso-bidi-font-weight:normal'>nextPosInFile</b>
tells where in the file the next chunk to be read begins.<span
style="mso-spacerun: yes">&nbsp; </span>Initially, it will be given by the
current position in the file, but will be adjusted after each chunk is read.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'>virtAddr
= buffer asInteger<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'>virtPage
= virtAddr / PAGE_SIZE<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'>offset
= virtAddr % PAGE_SIZE<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'>copiedSoFar
= 0<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'>nextPosInFile
= ...<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><o:p>&nbsp;</o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'>--
Each iteration will compute the size of the next chunk<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'>--
and process it...<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'>while
true<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><o:p>&nbsp;</o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>-- Compute the size of this chunk...<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>thisChunkSize = PAGE_SIZE-offset<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>if nextPosInFile + thisChunkSize &gt;
sizeOfFile<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>thisChunkSize = sizeOfFile
- nextPosInFile<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>if copiedSoFar + thisChunkSize &gt;
sizeInBytes<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>thisChunkSize = sizeInBytes
- copiedSoFar<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><o:p>&nbsp;</o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>-- See if we are done...<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>if thisChunkSize &lt;= 0<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>exit loop<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><o:p>&nbsp;</o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>-- Check for errors...<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>if (virtPage &lt; 0) or<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span>(page number is too
large) or<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span>(page is not valid)
or <o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span>(page is not
writable)<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>deal with errors<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><o:p>&nbsp;</o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>-- Do the read...<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>Set “DirtyBit” for this page<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>Set “ReferencedBit” for this page<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>Compute destAddr =
addrSpace.ExtractFrameAddr (virtPage) + offset<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>Perform read into destAddr,
nextPosInFile, chunkSize bytes<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><o:p>&nbsp;</o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>-- Increment...<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>nextPosInFile = nextPosInFile +
thisChunkSize<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>copiedSoFar = copiedSoFar +
thisChunkSize<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>virtPage = virtPage + 1<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>offset = 0<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><o:p>&nbsp;</o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>-- See if we are done...<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp; </span>if copiedSoFar == sizeInBytes<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><span
style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>exit loop<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'><o:p>&nbsp;</o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-family:Courier'>endWhile<o:p></o:p></span></p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>Note that we are marking the page in the user’s virtual
address space as “dirty.”<span style="mso-spacerun: yes">&nbsp; </span>Think
carefully about why a “read” would mark the page dirty.<span
style="mso-spacerun: yes">&nbsp; </span>When implementing the <b
style='mso-bidi-font-weight:normal'>Write</b> syscall, the operation will <u>not</u>
cause the page to become dirty!</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>When a user-program <i style='mso-bidi-font-style:normal'>reads</i>
data from disk to memory, the page in memory is changed.<span
style="mso-spacerun: yes">&nbsp; </span>So the page that receives the data from
disk must be marked as dirty.<span style="mso-spacerun: yes">&nbsp; </span>When
a user-program <i style='mso-bidi-font-style:normal'>writes</i> data from
memory to disk, the page in memory is unchanged.<span style="mso-spacerun:
yes">&nbsp; </span>The page would not be marked dirty.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>You also need to set the <b style='mso-bidi-font-weight:
normal'>Referenced Bit</b> for all pages accessed, regardless of whether the
user is invoking the <b style='mso-bidi-font-weight:normal'>Read</b> or <b
style='mso-bidi-font-weight:normal'>Write</b> syscall, since in either case,
the page has been used.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>Normally, the MMU will set the <b style='mso-bidi-font-weight:
normal'>Dirty</b> <b style='mso-bidi-font-weight:normal'>Bit</b> and <b
style='mso-bidi-font-weight:normal'>Referenced Bit</b> when appropriate, but
this will only occur when paging is turned on.<span style="mso-spacerun:
yes">&nbsp; </span>When the kernel handles the <b style='mso-bidi-font-weight:
normal'>Read</b> and <b style='mso-bidi-font-weight:normal'>Write </b>syscalls,
it will be accessing the pages directly, using their physical memory
addresses.<span style="mso-spacerun: yes">&nbsp; </span>This will bypass the
MMU, so the kernel code will need to change the bits explicitly.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>[Setting the <b style='mso-bidi-font-weight:normal'>Dirty
Bit</b> correctly will be necessary if we implement virtual memory in a later
project.<span style="mso-spacerun: yes">&nbsp; </span>A failure to set the
dirty bit correctly might occasionally result in data that gets lost when a
page that should be copied to disk is not copied.<span style="mso-spacerun:
yes">&nbsp; </span>A failure to set the referenced bit may have repercussions
for the page replacement algorithm, causing it to malfunction.<span
style="mso-spacerun: yes">&nbsp; </span>The resulting thrashing or poor
performance might be very, very difficult to debug and fix!]</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>It is possible that the user will provide bad arguments to
the <b style='mso-bidi-font-weight:normal'>Read</b> syscall.<span
style="mso-spacerun: yes">&nbsp; </span>For example, the user target area may
lie outside of the virtual address space or may be in a page that is not
writable.<span style="mso-spacerun: yes">&nbsp; </span>In such a case, the
kernel should detect the error and return &#8211;1.<span style="mso-spacerun:
yes">&nbsp; </span>Furthermore, if such a problem with the parameters occurs,
the kernel should not perform any disk operation.<span style="mso-spacerun:
yes">&nbsp; </span>In other words, the user target area should be entirely
unchanged.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>This is not how the above code works.<span
style="mso-spacerun: yes">&nbsp; </span>If, for example, the user target area
runs past the end of the virtual address space, the above code may read several
chunks successfully before encountering the error and aborting.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>To perform correctly, you’ll actually need to do the work
using two loops.<span style="mso-spacerun: yes">&nbsp; </span>You’ll execute
one loop to completion, then execute the second loop.<span style="mso-spacerun:
yes">&nbsp; </span>Both loops will be just like the one shown above, except
that the first loop will not actually perform the reading.<span
style="mso-spacerun: yes">&nbsp; </span>The sole purpose of the first loop is
to check the user target area and return from the syscall if problems.<span
style="mso-spacerun: yes">&nbsp; </span>The second loop will repeat the
computations exactly and will also perform the reading operations.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter><b style='mso-bidi-font-weight:normal'>FileManager.SynchRead</b>
will never fail; as coded it always returns true.</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>A similar approach to <b style='mso-bidi-font-weight:normal'>Handle_Sys_Read</b>
can be taken for <b style='mso-bidi-font-weight:normal'>Handle_Sys_Write</b>.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>Implementing Handle-Sys-Seek:</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>Here are some actions you’ll need to take when to
implementing the <b style='mso-bidi-font-weight:normal'>Seek</b> syscall:</p>

<p class=MsoFooter><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.25in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Lock
the <b style='mso-bidi-font-weight:normal'>FileManager</b> since we will be
updating shared data (the <b style='mso-bidi-font-weight:normal'>OpenFile.currentPos</b>)</p>

<p class=MsoFooter style='tab-stops:.25in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Check
the <b style='mso-bidi-font-weight:normal'>fileDesc</b> argument and get a
pointer to the <b style='mso-bidi-font-weight:normal'>OpenFile</b> object.</p>

<p class=MsoFooter style='tab-stops:.25in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Make
sure the file is open.<span style="mso-spacerun: yes">&nbsp; </span>(Recall
that a null entry in <b style='mso-bidi-font-weight:normal'>fileDescriptors</b>
means “not open.”)</p>

<p class=MsoFooter style='tab-stops:.25in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Deal
with the possibility that the new current position is equal to &#8211;1, which
has a special meaning.</p>

<p class=MsoFooter style='tab-stops:.25in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Deal
with the possibility that the new current position is less that &#8211;1.<span
style="mso-spacerun: yes">&nbsp; </span>(Zero is okay.)</p>

<p class=MsoFooter style='tab-stops:.25in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Deal
with the possibility that the new current position is greater than the file
size.</p>

<p class=MsoFooter style='tab-stops:.25in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Update
the current position.</p>

<p class=MsoFooter style='tab-stops:.25in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Return
the new current position.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Remember to unlock the <b
style='mso-bidi-font-weight:normal'>FileManager</b>, regardless of whether you
are making a normal return or an error return.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>The User-Level Programs</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <b style='mso-bidi-font-weight:normal'>p7</b> directory
contains a new user-level program called:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='tab-stops:.25in 1.5in'><span style='mso-tab-count:
1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b style='mso-bidi-font-weight:normal'>TestProgram4</b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Please change <b style='mso-bidi-font-weight:normal'>InitUserProcess</b>
to load <b style='mso-bidi-font-weight:normal'>TestProgram4</b> as the initial
process.<span style="mso-spacerun: yes">&nbsp; </span>Then run it<span
style="mso-spacerun: yes">&nbsp; </span>several times, once for each of the
tests it contains.<b style='mso-bidi-font-weight:normal'><o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>After you have finished coding and
debugging, please run each test once and hand in the output from each
test.<span style="mso-spacerun: yes">&nbsp; </span>A separate document shows
more-or-less what the correct output should look like.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Use the same code to execute all
tests.<span style="mso-spacerun: yes">&nbsp; </span>Please hand in only one
copy of your <b style='mso-bidi-font-weight:normal'>Kernel.c</b> code and do
not hand in any output that was produced by a different version of your code!</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><i style='mso-bidi-font-style:normal'><u>Do
not change <b style='mso-bidi-font-weight:normal'>TestProgram4</b></u></i>,
except to uncomment one of the lines in the <b style='mso-bidi-font-weight:
normal'>main</b> function.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>During your testing, it may be
convenient to modify the tests as you try to see what is going on and get
things to work.<span style="mso-spacerun: yes">&nbsp; </span>Before you make
your final test runs, <u>please recopy <b style='mso-bidi-font-weight:normal'>TestProgram4.c</b>
from our directory</u>, so that you get a fresh, unaltered version.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Please hand in hardcopy of <b
style='mso-bidi-font-weight:normal'>Kernel.c</b>.<span style="mso-spacerun:
yes">&nbsp; </span>You only need to hand in...</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<b style='mso-bidi-font-weight:normal'><span style='font-size:12.0pt;
mso-bidi-font-size:10.0pt;font-family:Times;mso-fareast-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";mso-ansi-language:EN-US;mso-fareast-language:
EN-US'><br clear=ALL style='page-break-before:always'>
</span></b>

<p class=MsoFooter style='tab-stops:.5in'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b
style='mso-bidi-font-weight:normal'>Handle_Sys_Open<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Handle_Sys_Close<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Handle_Sys_Read<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Handle_Sys_Write<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Handle_Sys_Seek<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>and any other code you wrote /
modified, like <b style='mso-bidi-font-weight:normal'>Handle_Sys_Fork</b> and <b
style='mso-bidi-font-weight:normal'>ProcessFinish</b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>Desired Output</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>There is some sample output, collected together into a
separate file called <b style='mso-bidi-font-weight:normal'>DesiredOutput.pdf</b>
in the p7 directory.</p>

</div>

</body>

</html>
