<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns:css="http://macVmlSchemaUri" xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta name=Title content="Project 8">
<meta name=Keywords content="">
<meta http-equiv=Content-Type content="text/html; charset=macintosh">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 2008">
<meta name=Originator content="Microsoft Word 2008">
<link rel=File-List href="proj8_files/filelist.xml">
<link rel=Edit-Time-Data href="proj8_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>Project 8</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Harry H. Porter III</o:Author>
  <o:Template>Normal.dotm</o:Template>
  <o:LastAuthor>Harry</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>9727</o:TotalTime>
  <o:LastPrinted>2009-06-10T21:56:00Z</o:LastPrinted>
  <o:Created>2009-06-10T21:57:00Z</o:Created>
  <o:LastSaved>2009-06-10T21:57:00Z</o:LastSaved>
  <o:Pages>4</o:Pages>
  <o:Words>5433</o:Words>
  <o:Characters>27712</o:Characters>
  <o:Lines>729</o:Lines>
  <o:Paragraphs>258</o:Paragraphs>
  <o:CharactersWithSpaces>38036</o:CharactersWithSpaces>
  <o:Version>12.0</o:Version>
 </o:DocumentProperties>
 <o:OfficeDocumentSettings>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:ActiveWritingStyle Lang="EN-US" VendorID="6" DLLVersion="2" NLCheck="0">1</w:ActiveWritingStyle>
  <w:SpellingState>Clean</w:SpellingState>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:HyphenationZone>0</w:HyphenationZone>
  <w:DoNotHyphenateCaps/>
  <w:DrawingGridHorizontalSpacing>0 pt</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>0 pt</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>0</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:ValidateAgainstSchemas>false</w:ValidateAgainstSchemas>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotUnderlineInvalidXML/>
  <w:DrawingGridHorizontalOrigin>0 pt</w:DrawingGridHorizontalOrigin>
  <w:DrawingGridVerticalOrigin>0 pt</w:DrawingGridVerticalOrigin>
  <w:DoNotShadeFormData/>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:UseNormalStyleForList/>
   <w:DontUseIndentAsNumberingTabStop/>
   <w:DontGrowAutofit/>
   <w:FELineBreak11/>
   <w:WW11IndentRules/>
   <w:DontAutofitConstrainedTables/>
   <w:AutofitLikeWW11/>
   <w:HangulWidthLikeWW11/>
  </w:Compatibility>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="276">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:"Courier New";
	panose-1:2 7 3 9 2 2 5 2 4 4;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Times;
	panose-1:2 0 5 0 0 0 0 0 0 0;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:"New York";
	panose-1:2 2 5 2 6 3 5 6 2 4;
	mso-font-alt:"Times New Roman";
	mso-font-charset:77;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:"Apple Chancery";
	panose-1:3 2 7 2 4 5 6 6 5 4;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	text-align:justify;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-hansi-font-family:Times;
	mso-font-kerning:0pt;
	text-decoration:underline;
	text-underline:single;}
h2
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-hansi-font-family:Times;
	text-decoration:underline;
	text-underline:single;}
h3
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:14.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-hansi-font-family:Times;
	text-decoration:underline;
	text-underline:single;}
h4
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:4;
	font-size:20.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-hansi-font-family:Times;}
h5
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:5;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Courier New";
	mso-hansi-font-family:"Courier New";}
h6
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:none;
	page-break-after:avoid;
	mso-outline-level:6;
	mso-layout-grid-align:none;
	text-autospace:none;
	font-size:14.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-hansi-font-family:Times;
	color:black;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 3.0in right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 3.0in right 6.0in;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{margin:0in;
	margin-bottom:.0001pt;
	text-align:justify;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
p.MsoBodyTextIndent, li.MsoBodyTextIndent, div.MsoBodyTextIndent
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.25in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
p.MsoBodyText2, li.MsoBodyText2, div.MsoBodyText2
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
p.MsoBodyText3, li.MsoBodyText3, div.MsoBodyText3
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
p.MsoBodyTextIndent2, li.MsoBodyTextIndent2, div.MsoBodyTextIndent2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Times;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Times;
	mso-bidi-font-family:"Times New Roman";}
p.MsoBodyTextIndent3, li.MsoBodyTextIndent3, div.MsoBodyTextIndent3
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.25in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Courier;
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:Courier;
	mso-bidi-font-family:"Times New Roman";
	font-weight:bold;
	mso-bidi-font-weight:normal;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-noshow:yes;
	color:purple;
	text-decoration:underline;
	text-underline:single;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
 /* Page Definitions */
@page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in .75in 1.0in .75in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-header:url(":proj8_files:header.htm") h1;
	mso-footer:url(":proj8_files:header.htm") f1;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"New York";
	mso-hansi-font-family:"New York";}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'><b style='mso-bidi-font-weight:
normal'><span style='font-size:20.0pt;mso-bidi-font-size:10.0pt'>Programming
Project 8:<o:p></o:p></span></b></p>

<h4>The Serial I/O Device Driver</h4>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-align:justify'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-align:justify'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-align:justify'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><u><span
style='font-size:14.0pt;mso-bidi-font-size:10.0pt'>Due Date:</span></u></b><span
style='font-size:14.0pt;mso-bidi-font-size:10.0pt'> </span>______________________________</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><u><span
style='font-size:14.0pt;mso-bidi-font-size:10.0pt'>Project Duration:</span></u></b><span
style='font-size:14.0pt;mso-bidi-font-size:10.0pt'><span style="mso-spacerun:
yes">&nbsp; </span></span>One week</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h3>Overview and Goal</h3>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In this project, you will implement a device driver and will
modify the <span class=SpellE>syscall</span> interface to allow application
programs to access this device, which is the serial terminal interface.<span
style="mso-spacerun: yes">&nbsp; </span>The goals include learning how the
kernel makes the connection between <span class=SpellE>syscalls</span> and
device drivers and gaining additional experience in concurrent programming in
the context of an OS kernel.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>With the addition of serial I/O to the kernel, your growing
OS will now be able to run a “shell” program.<span style="mso-spacerun:
yes">&nbsp; </span>This will give you the ability to interact with the OS in
the same way Unix users interact with a Unix shell.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>Download New Files</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The files for this project are available in:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b
style='mso-bidi-font-weight:normal'><span style='font-family:Courier'>http://www.cs.pdx.edu/~harry/Blitz/OSProject/p8/</span></b><span
style='font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The following files are new to this project:</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><a
name="OLE_LINK1">TestProgram</a>5.h<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>TestProgram5.c<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>sh.h</span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>sh.c</span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>cat.h</span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>cat.c</span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>hello.h</span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>hello.c</span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>fileA</span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>fileB</span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>fileC</span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>fileD</span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>script<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>help<o:p></o:p></span></b></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The following files have been modified from the last
project:</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>makefile</span><o:p></o:p></span></b></p>

<p class=MsoNormal><span style='font-family:Courier'><span style='mso-tab-count:
1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><b style='mso-bidi-font-weight:normal'>DISK<o:p></o:p></b></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <span class=SpellE><b style='mso-bidi-font-weight:normal'>makefile</b></span>
has been modified to compile the new programs.<span style="mso-spacerun:
yes">&nbsp; </span>The <b style='mso-bidi-font-weight:normal'>DISK</b> file has
been enlarged, since the previous version was too small to accommodate all
these new files.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>All remaining files are unchanged from the last project.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>Changes to the <span class=SpellE>Syscall</span> Interface</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In this project, you will alter a couple of the <span
class=SpellE>syscalls</span> to allow the user program to access the serial
device.<span style="mso-spacerun: yes">&nbsp; </span>The serial device is an
ASCII “dumb” terminal; individual characters can be sent and received
asynchronously, one-by-one.<span style="mso-spacerun: yes">&nbsp;
</span>Characters sent as output to the BLITZ serial device will appear
directly on the screen (in the window where the emulator is being run) and
characters typed at the keyboard will appear as input to the BLITZ serial
device.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Unix divides all I/O into 2 class called “character” and
“block.”<span style="mso-spacerun: yes">&nbsp; </span>In Unix, user programs
can operate character-oriented devices (like keyboards, dumb terminals, tapes,
etc.) using the same <span class=SpellE>syscalls</span> as for block devices
(like the disk).<span style="mso-spacerun: yes">&nbsp; </span>Your kernel will
also use the same <span class=SpellE>syscalls</span>, so in this project you
will not add any new <span class=SpellE>syscalls</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>To send or receive characters to/from the serial terminal
device, the user program will first invoke the <b style='mso-bidi-font-weight:
normal'>Open</b> <span class=SpellE>syscall</span> to get a file descriptor.<span
style="mso-spacerun: yes">&nbsp; </span>Then the user program will invoke <b
style='mso-bidi-font-weight:normal'>Read</b> to get several characters or <b
style='mso-bidi-font-weight:normal'>Write</b> to put several characters to the
terminal.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In the last project, the <b style='mso-bidi-font-weight:
normal'>Open</b> <span class=SpellE>syscall</span> was passed a filename.<span
style="mso-spacerun: yes">&nbsp; </span>In this project, the behavior of <b
style='mso-bidi-font-weight:normal'>Open</b> will be modified slightly: if the
filename argument happens to be the special string “<b style='mso-bidi-font-weight:
normal'>terminal</b>”, your kernel will not search the disk for a file with
that name; instead your kernel will return a file descriptor that refers to the
serial terminal device.<span style="mso-spacerun: yes">&nbsp; </span>Sometimes
we call this the “terminal file,” but it is not really a file at all.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <b style='mso-bidi-font-weight:normal'>Close</b> <span
class=SpellE>syscall</span> is passed a file descriptor.<span
style="mso-spacerun: yes">&nbsp; </span>When <b style='mso-bidi-font-weight:
normal'>Close</b> is passed a file descriptor referring to the terminal “file,”
it will work pretty much the same (from the user-level view) as with a disk
file.<span style="mso-spacerun: yes">&nbsp; </span>The file descriptor will be
marked as unused and free and any further attempt to read or write with that
file descriptor will cause errors.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>It is an error to use the <b style='mso-bidi-font-weight:
normal'>Seek</b> <span class=SpellE>syscall</span> on the terminal file.<span
style="mso-spacerun: yes">&nbsp; </span>If passed a file descriptor referring
to the terminal file, <b style='mso-bidi-font-weight:normal'>Seek</b> should
return &#8211;1.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>When the <b style='mso-bidi-font-weight:normal'>Read</b> <span
class=SpellE>syscall</span> is applied to the terminal file, it will return
characters up to either the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>sizeInBytes</b></span> of the buffer or to the next newline character (<b
style='mso-bidi-font-weight:normal'>\n</b>), whichever occurs first.<span
style="mso-spacerun: yes">&nbsp; </span><b style='mso-bidi-font-weight:normal'>Read</b>
will return the number of characters gotten, including the newline
character.<span style="mso-spacerun: yes">&nbsp; </span><b style='mso-bidi-font-weight:
normal'>Read</b> will wait for characters to be typed, if necessary.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>When the <b style='mso-bidi-font-weight:normal'>Write</b> <span
class=SpellE>syscall</span> is applied to the terminal file, it will send the
characters in the buffer to the serial terminal device, so they will appear on the
screen.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>The <b style='mso-bidi-font-weight:
normal'>Create</b> <span class=SpellE>syscall</span> will not be implemented
this term.<span style="mso-spacerun: yes">&nbsp; </span>(It would need to
disallow the creation of a file called “terminal”.)</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3><o:p><span style='text-decoration:none'>&nbsp;</span></o:p></h3>

<h3>Resources</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The following sections from the document titled “The BLITZ
Emulator” are relevant:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Emulating
the BLITZ Input/Output Devices (near page 25)</p>

<p class=MsoNormal><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Memory-Mapped
I/O (near page 25)</p>

<p class=MsoNormal><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The
Serial I/O Device (near page 27)</p>

<p class=MsoNormal><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Echoing
and Buffering of Raw and Cooked Serial Input (near page 28)</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>You might want to stop and read this material before
continuing with this document.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>Implementation Hints</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In this section, we will make some suggestions about how you
might implement the required functionality.<span style="mso-spacerun:
yes">&nbsp; </span>You are free to follow our design but you might want to stop
here and think about how you might design it, before you read about the design
we are providing.<span style="mso-spacerun: yes">&nbsp; </span>You may have
some very different&#8212;and better&#8212;ideas.<span style="mso-spacerun:
yes">&nbsp; </span>It may also be more rewarding and fun to work through your
own design.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Here are the changes our design would require you to make to
<span class=SpellE><b style='mso-bidi-font-weight:normal'>Kernel.h</b></span>.<span
style="mso-spacerun: yes">&nbsp; </span>These will be discussed below as we
describe our suggested approach, but all the changes are given here, for your
reference.</p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>The following should already be in your <span class=SpellE><b
style='mso-bidi-font-weight:normal'>Kernel.h</b></span> file:</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>const<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span>SERIAL_GET_BUFFER_SIZE = 10<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span>SERIAL_PUT_BUFFER_SIZE = 10<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>enum</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'> FILE,
TERMINAL, PIPE<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>The following should also be there; uncomment it.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:.25in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>var</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span><span class=SpellE>serialDriver</span>: <span class=SpellE>SerialDriver</span><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Add a new global variable:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:.25in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>var</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span><span class=SpellE>serialHasBeenInitialized</span>: <span
class=SpellE>bool</span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Add a new class called <span class=SpellE><b
style='mso-bidi-font-weight:normal'>SerialDriver</b></span>:</p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>------------------------<span
style="mso-spacerun: yes">&nbsp; </span><span class=SpellE>SerialDriver</span><span
style="mso-spacerun: yes">&nbsp; </span>----------------------------<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>--<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>--<span style="mso-spacerun:
yes">&nbsp; </span>There is only one instance of this class.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>--<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>const<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span>SERIAL_CHARACTER_AVAILABLE_BIT<span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>= 0x00000001<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span>SERIAL_OUTPUT_READY_BIT<span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>= 0x00000002<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span>SERIAL_STATUS_WORD_ADDRESS<span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>= 0x00FFFF00<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span>SERIAL_DATA_WORD_ADDRESS<span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>= 0x00FFFF04<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>class <span class=SpellE>SerialDriver</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span>superclass Object<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span>fields<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>serial_status_word_address</span>:
<span class=SpellE>ptr</span> to <span class=SpellE>int</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>serial_data_word_address</span>:
<span class=SpellE>ptr</span> to <span class=SpellE>int</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>serialLock</span>: <span
class=SpellE>Mutex</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>getBuffer</span>: array
[SERIAL_GET_BUFFER_SIZE] of char<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>getBufferSize</span>: <span
class=SpellE>int</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>getBufferNextIn</span>: <span
class=SpellE>int</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>getBufferNextOut</span>: <span
class=SpellE>int</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>getCharacterAvail</span>:
Condition<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>putBuffer</span>: array
[SERIAL_PUT_BUFFER_SIZE] of char<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>putBufferSize</span>: <span
class=SpellE>int</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>putBufferNextIn</span>: <span
class=SpellE>int</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>putBufferNextOut</span>: <span
class=SpellE>int</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>putBufferSem</span>:
Semaphore<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>serialNeedsAttention</span>:
Semaphore<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>serialHandlerThread</span>:
Thread<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span>methods<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span>Init ()<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>PutChar</span> (value: char)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>GetChar</span> () returns
char<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>SerialHandler</span> ()<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>endClass</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>The following field should already be present in class <span
class=SpellE><b style='mso-bidi-font-weight:normal'>FileManager</b></span>:</p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>serialTerminalFile</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>: <span
class=SpellE>OpenFile</span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>The following field should already be present in class <span
class=SpellE><b style='mso-bidi-font-weight:normal'>OpenFile</b></span>:</p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>kind: <span class=SpellE>int</span><span
style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>-- FILE, TERMINAL, or PIPE<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The serial device driver code will go into the class <span
class=SpellE><b style='mso-bidi-font-weight:normal'>SerialDriver</b></span>, of
which there will be exactly one instance called <span class=SpellE><b
style='mso-bidi-font-weight:normal'>serialDriver</b></span>.<span
style="mso-spacerun: yes">&nbsp; </span>In analogy to the disk driver, the
single <span class=SpellE><b style='mso-bidi-font-weight:normal'>SerialDriver</b></span>
object should be created in <b style='mso-bidi-font-weight:normal'>Main</b> at
startup time and the <b style='mso-bidi-font-weight:normal'>Init</b> method
should be called during startup to initialize it.<span style="mso-spacerun:
yes">&nbsp; </span>You’ll need to modify <span class=SpellE><b
style='mso-bidi-font-weight:normal'>Main.c</b></span> accordingly.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <span class=SpellE><b style='mso-bidi-font-weight:normal'>SerialDriver</b></span>
has many fields, but basically it maintains two FIFO queues called <span
class=SpellE><b style='mso-bidi-font-weight:normal'>putBuffer</b></span> and <span
class=SpellE><b style='mso-bidi-font-weight:normal'>getBuffer</b></span>.<span
style="mso-spacerun: yes">&nbsp; </span>The <span class=SpellE><b
style='mso-bidi-font-weight:normal'>putBuffer</b></span> contains all the
characters that are waiting to be printed and the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>getBuffer</b></span> contains all the
characters that have been typed but not yet requested by a user program.<span
style="mso-spacerun: yes">&nbsp; </span>The <span class=SpellE><b
style='mso-bidi-font-weight:normal'>getBuffer</b></span> allows users to type
ahead.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>There will be only two methods that users of the serial
device will invoke: <span class=SpellE><b style='mso-bidi-font-weight:normal'>PutChar</b></span>
and <span class=SpellE><b style='mso-bidi-font-weight:normal'>GetChar</b></span>.<span
style="mso-spacerun: yes">&nbsp; </span><span class=SpellE><b style='mso-bidi-font-weight:
normal'>PutChar</b></span> is passed a character, which it will add to the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>putBuffer</b></span>
queue.<span style="mso-spacerun: yes">&nbsp; </span>If the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>putBuffer</b></span> is full, the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>PutChar</b></span> method
will block; otherwise it will return immediately after buffering the
character.<span style="mso-spacerun: yes">&nbsp; </span><span class=SpellE><b
style='mso-bidi-font-weight:normal'>PutChar</b></span> will not wait for the
I/O to complete.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <span class=SpellE><b style='mso-bidi-font-weight:normal'>GetChar</b></span>
method will get a character from the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>getBuffer</b></span> queue and return it.<span style="mso-spacerun:
yes">&nbsp; </span>If the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>getBuffer</b></span> queue is empty (i.e., there is no type-ahead), <span
class=SpellE><b style='mso-bidi-font-weight:normal'>GetChar</b></span> will
block and wait for the user to type a character before returning.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <b style='mso-bidi-font-weight:normal'>Read</b> <span
class=SpellE>syscall</span> handler should invoke the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>GetChar</b></span> method and the <b
style='mso-bidi-font-weight:normal'>Write</b> <span class=SpellE>syscall</span>
handler should invoke the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>PutChar</b></span> method.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Each of these buffers is a shared resource and the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>SerialDevice</b></span>
class is a monitor, regulating concurrent access by several threads.<span
style="mso-spacerun: yes">&nbsp; </span>The buffers will be read and updated in
the <span class=SpellE><b style='mso-bidi-font-weight:normal'>GetChar</b></span>,
<span class=SpellE><b style='mso-bidi-font-weight:normal'>PutChar</b></span>
and <span class=SpellE><b style='mso-bidi-font-weight:normal'>SerialHandler</b></span>
methods, so the data must be protected from getting corrupted.<span
style="mso-spacerun: yes">&nbsp; </span>To regulate access to the shared data
in the <span class=SpellE><b style='mso-bidi-font-weight:normal'>SerialDriver</b></span>,
the field <span class=SpellE><b style='mso-bidi-font-weight:normal'>serialLock</b></span><span
style="mso-spacerun: yes">&nbsp; </span>is a <span class=SpellE>mutex</span>
lock which must be acquired before accessing either of the buffers.<span
style="mso-spacerun: yes">&nbsp; </span>(Our design uses only one lock for both
buffers, but using two locks would allow more concurrency.)</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Look at <span class=SpellE><b style='mso-bidi-font-weight:
normal'>getBuffer</b></span> first.<span style="mso-spacerun: yes">&nbsp;
</span>The <span class=SpellE><b style='mso-bidi-font-weight:normal'>GetChar</b></span>
routine is an entry method.<span style="mso-spacerun: yes">&nbsp; </span>As
such it must acquire the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>serialLock</b></span> as its first operation.<span style="mso-spacerun:
yes">&nbsp; </span>The variables <span class=SpellE><b style='mso-bidi-font-weight:
normal'>getBufferSize</b></span>, <span class=SpellE><b style='mso-bidi-font-weight:
normal'>getBufferIn</b></span>, and <span class=SpellE><b style='mso-bidi-font-weight:
normal'>getBufferOut</b></span> describe the status of the buffer.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Here is a <span class=SpellE><b style='mso-bidi-font-weight:
normal'>getBuffer</b></span> containing “<span class=SpellE>abc</span>”.<span
style="mso-spacerun: yes">&nbsp; </span>The next character to be fetched by <span
class=SpellE><b style='mso-bidi-font-weight:normal'>GetChar</b></span> is
“a”.<span style="mso-spacerun: yes">&nbsp; </span>The most recently typed
character is “c”.</p>

<p class=MsoNormal><!--[if gte vml 1]><v:group id="_x0000_s1223" style='position:absolute;
 margin-left:73pt;margin-top:8pt;width:300pt;height:140pt;z-index:251658240'
 coordorigin="624,1328" coordsize="2400,1120">
 <v:rect id="_x0000_s1224" style='position:absolute;left:768;top:1488;width:1920;
  height:192;mso-wrap-style:none;v-text-anchor:middle' filled="f" fillcolor="#bbe0e3"
  strokeweight="2.25pt"/>
 <v:line id="_x0000_s1225" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="960,1488" to="961,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1226" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="1152,1488" to="1153,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1227" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="1344,1488" to="1345,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1228" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="1536,1488" to="1537,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1229" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="1728,1488" to="1729,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1230" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="1920,1488" to="1921,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1231" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="2112,1488" to="2113,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1232" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="2304,1488" to="2305,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1233" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="2496,1488" to="2497,1680" strokeweight="2.25pt"/>
 <v:rect id="_x0000_s1234" style='position:absolute;left:789;top:1328;width:332;
  height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>0<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1235" style='position:absolute;left:964;top:1331;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>1<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1236" style='position:absolute;left:1156;top:1331;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>2<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1237" style='position:absolute;left:1348;top:1330;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>3<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1238" style='position:absolute;left:1540;top:1337;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>4<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1239" style='position:absolute;left:1732;top:1338;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>5<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1240" style='position:absolute;left:1924;top:1337;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>6<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1241" style='position:absolute;left:2116;top:1337;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>7<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1242" style='position:absolute;left:2308;top:1337;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>8<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1243" style='position:absolute;left:2500;top:1337;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>9<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:line id="_x0000_s1244" style='position:absolute;flip:y;
  mso-wrap-style:none;v-text-anchor:middle' from="1248,1728" to="1249,1968"
  strokeweight="2.25pt">
  <v:stroke endarrow="open"/>
 </v:line><v:line id="_x0000_s1245" style='position:absolute;flip:y;
  mso-wrap-style:none;v-text-anchor:middle' from="1817,1728" to="1818,1968"
  strokeweight="2.25pt">
  <v:stroke endarrow="open"/>
 </v:line><v:rect id="_x0000_s1246" style='position:absolute;left:1158;top:1483;
  width:491;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:16.0pt;mso-bidi-font-size:10.0pt;color:black'>a<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1247" style='position:absolute;left:1346;top:1482;
  width:512;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:16.0pt;mso-bidi-font-size:10.0pt;color:black'>b<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1248" style='position:absolute;left:1546;top:1482;
  width:470;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:16.0pt;mso-bidi-font-size:10.0pt;color:black'>c<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1249" style='position:absolute;left:624;top:1948;
  width:1584;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>getBufferNextOut=2<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1250" style='position:absolute;left:1724;top:1940;
  width:1300;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>getBufferNextIn=5<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1251" style='position:absolute;left:960;top:2256;
  width:1392;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>getBufferSize=3<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect></v:group><![endif]--><![if !vml]><span style='mso-ignore:vglayout'>

<table cellpadding=0 cellspacing=0 align=left>
 <tr>
  <td width=73 height=8></td>
 </tr>
 <tr>
  <td></td>
  <td><img width=303 height=143 src="proj8_files/image001.png" v:shapes="_x0000_s1250 _x0000_s1251 _x0000_s1249 _x0000_s1247 _x0000_s1245 _x0000_s1243 _x0000_s1241 _x0000_s1239 _x0000_s1237 _x0000_s1235 _x0000_s1233 _x0000_s1231 _x0000_s1229 _x0000_s1227 _x0000_s1225 _x0000_s1223 _x0000_s1224 _x0000_s1226 _x0000_s1228 _x0000_s1230 _x0000_s1232 _x0000_s1234 _x0000_s1236 _x0000_s1238 _x0000_s1240 _x0000_s1242 _x0000_s1244 _x0000_s1246 _x0000_s1248"></td>
 </tr>
</table>

</span><![endif]><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<br style='mso-ignore:vglayout' clear=all>

<p class=MsoNormal>If the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>getBufferSize</b></span> is zero, then <span class=SpellE><b
style='mso-bidi-font-weight:normal'>GetChar</b></span> must wait on the
condition <span class=SpellE><b style='mso-bidi-font-weight:normal'>getCharacterAvail</b></span>,
which will be signaled with a <b style='mso-bidi-font-weight:normal'>Down()</b>
operation after a new character is received from the device and added to the
buffer.<span style="mso-spacerun: yes">&nbsp; </span>After getting a character,
<span class=SpellE><b style='mso-bidi-font-weight:normal'>GetChar</b></span>
must adjust <span class=SpellE><b style='mso-bidi-font-weight:normal'>getBufferNextOut</b></span>
and <span class=SpellE><b style='mso-bidi-font-weight:normal'>getBufferSize</b></span>
before releasing <span class=SpellE><b style='mso-bidi-font-weight:normal'>serialLock</b></span>
and returning the character.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Next look at <span class=SpellE><b style='mso-bidi-font-weight:
normal'>PutChar</b></span>.<span style="mso-spacerun: yes">&nbsp; </span>There
is a similar buffer called <span class=SpellE><b style='mso-bidi-font-weight:
normal'>putBuffer</b></span>.<span style="mso-spacerun: yes">&nbsp; </span>Here
is an example containing “xyz”.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><!--[if gte vml 1]><v:group id="_x0000_s1194" style='position:absolute;
 margin-left:31pt;margin-top:2pt;width:300pt;height:140pt;z-index:251657216'
 coordorigin="624,1328" coordsize="2400,1120">
 <v:rect id="_x0000_s1195" style='position:absolute;left:768;top:1488;width:1920;
  height:192;mso-wrap-style:none;v-text-anchor:middle' filled="f" fillcolor="#bbe0e3"
  strokeweight="2.25pt"/>
 <v:line id="_x0000_s1196" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="960,1488" to="961,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1197" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="1152,1488" to="1153,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1198" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="1344,1488" to="1345,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1199" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="1536,1488" to="1537,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1200" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="1728,1488" to="1729,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1201" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="1920,1488" to="1921,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1202" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="2112,1488" to="2113,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1203" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="2304,1488" to="2305,1680" strokeweight="2.25pt"/>
 <v:line id="_x0000_s1204" style='position:absolute;mso-wrap-style:none;
  v-text-anchor:middle' from="2496,1488" to="2497,1680" strokeweight="2.25pt"/>
 <v:rect id="_x0000_s1205" style='position:absolute;left:789;top:1328;width:332;
  height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>0<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1206" style='position:absolute;left:964;top:1331;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>1<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1207" style='position:absolute;left:1156;top:1331;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>2<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1208" style='position:absolute;left:1348;top:1330;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>3<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1209" style='position:absolute;left:1540;top:1337;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>4<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1210" style='position:absolute;left:1732;top:1338;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>5<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1211" style='position:absolute;left:1924;top:1337;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>6<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1212" style='position:absolute;left:2116;top:1337;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>7<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1213" style='position:absolute;left:2308;top:1337;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>8<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1214" style='position:absolute;left:2500;top:1337;
  width:332;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>9<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:line id="_x0000_s1215" style='position:absolute;flip:y;
  mso-wrap-style:none;v-text-anchor:middle' from="1248,1728" to="1249,1968"
  strokeweight="2.25pt">
  <v:stroke endarrow="open"/>
 </v:line><v:line id="_x0000_s1216" style='position:absolute;flip:y;
  mso-wrap-style:none;v-text-anchor:middle' from="1817,1728" to="1818,1968"
  strokeweight="2.25pt">
  <v:stroke endarrow="open"/>
 </v:line><v:rect id="_x0000_s1217" style='position:absolute;left:1158;top:1483;
  width:491;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:16.0pt;mso-bidi-font-size:10.0pt;color:black'>x<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1218" style='position:absolute;left:1346;top:1482;
  width:512;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:16.0pt;mso-bidi-font-size:10.0pt;color:black'>y<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1219" style='position:absolute;left:1546;top:1482;
  width:470;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:16.0pt;mso-bidi-font-size:10.0pt;color:black'>z<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1220" style='position:absolute;left:624;top:1948;
  width:1584;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>putBufferNextOut=2<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1221" style='position:absolute;left:1724;top:1940;
  width:1300;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>putBufferNextIn=5<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1222" style='position:absolute;left:960;top:2256;
  width:1392;height:192' filled="f" fillcolor="#bbe0e3" stroked="f">
  <v:textbox style='mso-fit-shape-to-text:t'>
   <![if !mso]>
   <table cellpadding=0 cellspacing=0 width="100%">
    <tr>
     <td><![endif]>
     <div>
     <p class=MsoNormal style='mso-pagination:none;mso-layout-grid-align:none;
     text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
     style='font-size:14.0pt;mso-bidi-font-size:10.0pt;color:black'>putBufferSize=3<o:p></o:p></span></b></p>
     </div>
     <![if !mso]></td>
    </tr>
   </table>
   <![endif]></v:textbox>
 </v:rect></v:group><![endif]--><![if !vml]><span style='mso-ignore:vglayout'>

<table cellpadding=0 cellspacing=0 align=left>
 <tr>
  <td width=31 height=2></td>
 </tr>
 <tr>
  <td></td>
  <td><img width=303 height=143 src="proj8_files/image002.png" v:shapes="_x0000_s1221 _x0000_s1222 _x0000_s1220 _x0000_s1218 _x0000_s1216 _x0000_s1214 _x0000_s1212 _x0000_s1210 _x0000_s1208 _x0000_s1206 _x0000_s1204 _x0000_s1202 _x0000_s1200 _x0000_s1198 _x0000_s1196 _x0000_s1194 _x0000_s1195 _x0000_s1197 _x0000_s1199 _x0000_s1201 _x0000_s1203 _x0000_s1205 _x0000_s1207 _x0000_s1209 _x0000_s1211 _x0000_s1213 _x0000_s1215 _x0000_s1217 _x0000_s1219"></td>
 </tr>
</table>

</span><![endif]><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<br style='mso-ignore:vglayout' clear=all>

<p class=MsoFooter style='tab-stops:.5in'>The <span class=SpellE><b
style='mso-bidi-font-weight:normal'>PutChar</b></span> method must first wait
until there is space in the buffer.<span style="mso-spacerun: yes">&nbsp;
</span>To handle this, You can use the semaphore called <span class=SpellE><b
style='mso-bidi-font-weight:normal'>putBufferSem</b></span>.<span
style="mso-spacerun: yes">&nbsp; </span>This semaphore is initialized with</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><span style='font-family:Courier'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=SpellE>putBufferSem.Init</span>
(SERIAL_PUT_BUFFER_SIZE)<o:p></o:p></span></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>which starts the semaphore with one
excess signal per available buffer entry.<span style="mso-spacerun: yes">&nbsp;
</span>Each time a character is removed from the buffer, it will create an
additional space, so every time a character is removed (by the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>SerialHandler</b></span>
method, discussed later), the semaphore will be signaled with an <b
style='mso-bidi-font-weight:normal'>Up</b> operation.<span style="mso-spacerun:
yes">&nbsp; </span>By waiting on the semaphore with <b style='mso-bidi-font-weight:
normal'>Down</b>, <span class=SpellE><b style='mso-bidi-font-weight:normal'>PutChar</b></span>
ensures that there is at least one free space.<span style="mso-spacerun:
yes">&nbsp; </span>Then it acquires the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>serialLock</b></span>.<span style="mso-spacerun: yes">&nbsp;
</span>(Note that even though other threads may sneak in and run between the
completion of the <b style='mso-bidi-font-weight:normal'>Down</b> and the
acquisition of the <span class=SpellE><b style='mso-bidi-font-weight:normal'>serialLock</b></span>,
there will always be at least one free space.)</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><span class=SpellE><b
style='mso-bidi-font-weight:normal'>PutChar</b></span> will then add its
character to the next “in” spot in the buffer and adjust <span class=SpellE><b
style='mso-bidi-font-weight:normal'>putBufferNextIn</b></span> and <span
class=SpellE><b style='mso-bidi-font-weight:normal'>putBufferSize</b></span>.<span
style="mso-spacerun: yes">&nbsp; </span>Then it will release the lock.<span
style="mso-spacerun: yes">&nbsp; </span>Finally, before returning, it will
signal another semaphore, called <span class=SpellE><b style='mso-bidi-font-weight:
normal'>serialNeedsAttention</b></span>, which will wake up the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>SerialHandler</b></span>
thread.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>In our design, the serial device will
be controlled by a kernel thread called “<span class=SpellE>SerialHandler</span>”.<span
style="mso-spacerun: yes">&nbsp; </span>Every time the serial device interrupts
the CPU, this thread will be awakened.<span style="mso-spacerun: yes">&nbsp;
</span>Also, every time <span class=SpellE><b style='mso-bidi-font-weight:normal'>PutChar</b></span>
adds a character to the <span class=SpellE><b style='mso-bidi-font-weight:normal'>putBuffer</b></span>,
this thread will be awakened.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>The <span class=SpellE><b
style='mso-bidi-font-weight:normal'>SerialHandler</b></span> thread has two
tasks.<span style="mso-spacerun: yes">&nbsp; </span>(1)<span
style="mso-spacerun: yes">&nbsp; </span>If a new character has been received
(i.e., the user has pressed a new key), the new character must be fetched from
the device and moved into the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>getBuffer</b></span>.<span style="mso-spacerun: yes">&nbsp; </span>(2)
If the serial transmission channel is free (i.e., done transmitting the
previous character) and there are more characters waiting in <span
class=SpellE><b style='mso-bidi-font-weight:normal'>putBuffer</b></span> to be
printed, the outputting of the next character must be started.<span
style="mso-spacerun: yes">&nbsp; </span>The thread must also wake up any other
threads waiting on the <span class=SpellE><b style='mso-bidi-font-weight:normal'>getBuffer</b></span>
(becoming non-empty) and the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>putBuffer</b></span> (becoming non-full).</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>In the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>SerialDriver</b></span> class there is a
semaphore called <span class=SpellE><b style='mso-bidi-font-weight:normal'>serialNeedsAttention</b></span>,
which will be signaled (with <b style='mso-bidi-font-weight:normal'>Up</b>) to
wake up the <span class=SpellE><b style='mso-bidi-font-weight:normal'>SerialHandler</b></span>
thread.<span style="mso-spacerun: yes">&nbsp; </span>The code for <span
class=SpellE><b style='mso-bidi-font-weight:normal'>SerialHandler</b></span> is
an infinite loop which waits on the semaphore, then checks things, and then
repeats (going to sleep until the next time the semaphore is signaled).</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>The <span class=SpellE><b
style='mso-bidi-font-weight:normal'>SerialInterruptHandler</b></span> routine
should be modified to signal the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>serialNeedsAttention</b></span> semaphore and thereby wake up the
serial handler thread.<span style="mso-spacerun: yes">&nbsp;
</span>Unfortunately, this semaphore will not be initialized when the OS first
begins.<span style="mso-spacerun: yes">&nbsp; </span>Although the semaphore
will be initialized as part of the OS startup, serial interrupts may occur from
the very beginning.<span style="mso-spacerun: yes">&nbsp; </span>An attempt to
signal a semaphore that has not yet been initialized will result in an
“uninitialized object” error.<span style="mso-spacerun: yes">&nbsp; </span>You
don’t want that!</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>To deal with serial interrupts that
might occur before the semaphore has been initialized, You can add a new global
variable</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='margin-left:.25in;tab-stops:.5in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>serialHasBeenInitialized</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>: <span
class=SpellE>bool</span><o:p></o:p></span></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>In KPL, global variables are always
initialized to their zero values; for a <span class=SpellE>boolean</span> this
is “false”.<span style="mso-spacerun: yes">&nbsp; </span>The code in <span
class=SpellE><b style='mso-bidi-font-weight:normal'>SerialDriver.Init</b></span>
should create the semaphore and initialize it.<span style="mso-spacerun:
yes">&nbsp; </span>As the last thing it does, <b style='mso-bidi-font-weight:
normal'>Init</b> should set</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='margin-left:.25in;tab-stops:.5in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>serialHasBeenInitialized</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'> = true<o:p></o:p></span></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Here is the code for the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>SerialInterruptHandler</b></span>
function:</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='margin-left:.25in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>currentInterruptStatus</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'> =
DISABLED<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>if <span class=SpellE>serialHasBeenInitialized</span><o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span><span class=SpellE>serialDriver.serialNeedsAttention.Up</span>()<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>endIf</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'><o:p></o:p></span></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Next let’s look at <span
class=SpellE><b style='mso-bidi-font-weight:normal'>SerialDriver.Init</b></span>.<span
style="mso-spacerun: yes">&nbsp; </span>First it might want to print the
message “Initializing Serial Driver...”<span style="mso-spacerun: yes">&nbsp;
</span>The two fields called <span class=SpellE><b style='mso-bidi-font-weight:
normal'>serial_status_word_address</b></span> and <span class=SpellE><b
style='mso-bidi-font-weight:normal'>serial_data_word_address</b></span> are
pointers to the memory-mapped addresses of the two serial device
registers.<span style="mso-spacerun: yes">&nbsp; </span>They should be
initialized here and will never change.<span style="mso-spacerun: yes">&nbsp;
</span>(KPL cannot handle “const” values that are pointers, so instead, you can
make them fields of <span class=SpellE><b style='mso-bidi-font-weight:normal'>SerialDriver</b></span>.)</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Next, <b style='mso-bidi-font-weight:
normal'>Init</b> must initialize the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>serialLock</b></span>.<span style="mso-spacerun: yes">&nbsp;
</span>Then <b style='mso-bidi-font-weight:normal'>Init</b> must initialize the
fields associated with the input buffer.<span style="mso-spacerun: yes">&nbsp;
</span>They are: <span class=SpellE><b style='mso-bidi-font-weight:normal'>getBuffer</b></span>,
<span class=SpellE><b style='mso-bidi-font-weight:normal'>getBufferSize</b></span>,
<span class=SpellE><b style='mso-bidi-font-weight:normal'>getBufferNextIn</b></span>,
<span class=SpellE><b style='mso-bidi-font-weight:normal'>getBufferNextOut</b></span>,
and the <span class=SpellE><b style='mso-bidi-font-weight:normal'>GetCharacterAvail</b></span>
condition.<span style="mso-spacerun: yes">&nbsp; </span>Next, <b
style='mso-bidi-font-weight:normal'>Init</b> must initialize the fields
associated with the output buffer: <span class=SpellE><b style='mso-bidi-font-weight:
normal'>putBuffer</b></span>, <span class=SpellE><b style='mso-bidi-font-weight:
normal'>putBufferNextIn</b></span>, <span class=SpellE><b style='mso-bidi-font-weight:
normal'>putBufferNextOut</b></span>, and the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>putBufferSem</b></span> semaphore.<span
style="mso-spacerun: yes">&nbsp; </span>As mentioned above, the argument to <span
class=SpellE><b style='mso-bidi-font-weight:normal'>putBufferSem.Init</b></span>
indicates one initial signal per buffer slot.<span style="mso-spacerun:
yes">&nbsp; </span>Next, <b style='mso-bidi-font-weight:normal'>Init</b> must
initialize the <span class=SpellE><b style='mso-bidi-font-weight:normal'>serialNeedsAttention</b></span>
semaphore.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Then <b style='mso-bidi-font-weight:
normal'>Init</b> must create a new thread (a kernel thread) which will monitor
the serial terminal device.<span style="mso-spacerun: yes">&nbsp; </span>This
is the <span class=SpellE><b style='mso-bidi-font-weight:normal'>serialHandlerThread</b></span>
field in <span class=SpellE><b style='mso-bidi-font-weight:normal'>SerialDriver</b></span>.<span
style="mso-spacerun: yes">&nbsp; </span>As you know, the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>Thread.Fork</b></span> function requires a
pointer to a function and a single integer argument.<span style="mso-spacerun:
yes">&nbsp; </span>You should create a function (called <span class=SpellE><b
style='mso-bidi-font-weight:normal'>SerialHandlerFunction</b></span>) which
ignores the integer argument and immediately invokes <span class=SpellE><b
style='mso-bidi-font-weight:normal'>serialDriver.SerialHandler</b></span>
method.<span style="mso-spacerun: yes">&nbsp; </span>This method contains all
the code and it never returns.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Finally, the <b style='mso-bidi-font-weight:
normal'>Init</b> method should set <span class=SpellE><b style='mso-bidi-font-weight:
normal'>serialHasBeenInitialized</b></span> to true and return.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>As mentioned before, the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>SerialHandler</b></span>
method contains an infinite loop.<span style="mso-spacerun: yes">&nbsp;
</span>The first thing in the loop is a wait on the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>serialNeedsAttention</b></span> semaphore.<span
style="mso-spacerun: yes">&nbsp; </span>This semaphore can be signaled by
either the <span class=SpellE><b style='mso-bidi-font-weight:normal'>PutChar</b></span>
method (when a new character is added to the output queue) or when a serial
interrupt occurs.<span style="mso-spacerun: yes">&nbsp; </span>In either case,
the thread will wake up, check things, and then go back to sleep, waiting for
the next signal.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>When awakened, the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>SerialHandler</b></span>
thread will need to look at the serial device to see if a character has arrived
at the device (i.e., a key has been pressed).<span style="mso-spacerun:
yes">&nbsp; </span>So it must query the serial device status register and check
the “character available” bit.<span style="mso-spacerun: yes">&nbsp; </span>If
set to 1, it must get the character from the serial device data register.<span
style="mso-spacerun: yes">&nbsp; </span>Then the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>SerialHandler</b></span> must add it to the
input buffer.<span style="mso-spacerun: yes">&nbsp; </span>This requires first
acquiring the <span class=SpellE><b style='mso-bidi-font-weight:normal'>serialLock</b></span>.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>It is possible that the input buffer
is full and this must be checked for.<span style="mso-spacerun: yes">&nbsp;
</span>If the <span class=SpellE><b style='mso-bidi-font-weight:normal'>getBuffer</b></span>
is full, we have a case of the user typing too many characters ahead, before
the program has asked for them.<span style="mso-spacerun: yes">&nbsp; </span>In
our design, the character is simply dropped (i.e., do not add it to the
buffer).<span style="mso-spacerun: yes">&nbsp; </span>Instead, you should print
out a message containing the character.<span style="mso-spacerun: yes">&nbsp;
</span>This will be very helpful in debugging.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>print (&quot;\<span
class=SpellE>nSerial</span> input buffer overrun - character '&quot;)<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>printChar</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'> (<span
class=SpellE>inChar</span>)<o:p></o:p></span></p>

<p class=MsoFooter style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>print (&quot;' was <span
class=SpellE>ingored</span>\n&quot;)<o:p></o:p></span></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>After adding the character to the
buffer, the <span class=SpellE><b style='mso-bidi-font-weight:normal'>SerialHandler</b></span>
needs to signal the <span class=SpellE><b style='mso-bidi-font-weight:normal'>getCharacterAvail</b></span>
condition, then release the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>serialLock</b></span>.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>After dealing with the input stream,
the <span class=SpellE><b style='mso-bidi-font-weight:normal'>SerialHandler</b></span>
needs to look at the output stream.<span style="mso-spacerun: yes">&nbsp;
</span>(It would also be correct to handle the output before the input.)</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>First, you need to query the status
register and check the “output ready” bit.<span style="mso-spacerun:
yes">&nbsp; </span>A 1 bit indicates the device is ready to transmit another
character, so next you need to check to see if there are any characters queued
for output.<span style="mso-spacerun: yes">&nbsp; </span>Before you check <span
class=SpellE><b style='mso-bidi-font-weight:normal'>putBufferSize</b></span>,
you’ll need to acquire the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>serialLock</b></span>.<span style="mso-spacerun: yes">&nbsp; </span>If
there is at least one character in the queue, you can remove it (adjusting <span
class=SpellE><b style='mso-bidi-font-weight:normal'>putBufferSize</b></span>
and <span class=SpellE><b style='mso-bidi-font-weight:normal'>putBufferNextOut</b></span>)
and move it into the serial device data register.<span style="mso-spacerun:
yes">&nbsp; </span>Finally, you’ll need to signal <span class=SpellE><b
style='mso-bidi-font-weight:normal'>putBufferSem</b></span>, to wake up any <span
class=SpellE><b style='mso-bidi-font-weight:normal'>PutChar</b></span> threads
waiting to add characters to a full buffer.<span style="mso-spacerun:
yes">&nbsp; </span>And don’t forget to release the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>serialLock</b></span> no matter what the
code does or your OS will freeze up.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<span style='font-size:12.0pt;mso-bidi-font-size:10.0pt;font-family:Times;
mso-fareast-font-family:"Times New Roman";mso-bidi-font-family:"Times New Roman";
mso-ansi-language:EN-US;mso-fareast-language:EN-US'><br clear=ALL
style='mso-special-character:line-break;page-break-before:always'>
</span>

<div style='mso-element:para-border-div;border:solid windowtext 1.0pt;
border-bottom:none;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:
solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:1.0pt 4.0pt 0in 4.0pt;
margin-left:.25in;margin-right:.25in'>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-top-alt:solid windowtext .5pt;
mso-border-left-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
padding:0in;mso-padding-alt:1.0pt 4.0pt 0in 4.0pt'><o:p>&nbsp;</o:p></p>

</div>

<div style='mso-element:para-border-div;border-top:none;border-left:solid windowtext 1.0pt;
border-bottom:none;border-right:solid windowtext 1.0pt;mso-border-left-alt:
solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:0in 4.0pt 0in 4.0pt;
margin-left:.25in;margin-right:.25in'>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'>Regarding
buffers and pointers, here is a little trick.<span style="mso-spacerun:
yes">&nbsp; </span>Assume you have the following code (not part of this
project):</p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'><span
style='mso-tab-count:1'>&nbsp;&nbsp; </span><span class=SpellE>var</span>
buffer: array [MAX_SIZE] of char = ...<o:p></o:p></span></p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'><span
style='mso-tab-count:1'>&nbsp;&nbsp; </span><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>nextPos</span>: <span
class=SpellE>int</span><o:p></o:p></span></p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'>To
add an element to the buffer, you’ll need to increment the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>nextPos</b></span> index variable.<span
style="mso-spacerun: yes">&nbsp; </span>The following code uses the <b
style='mso-bidi-font-weight:normal'>mod</b> operator when it adds 1, which
cause the buffer to be a “circular” buffer.</p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'><span
style='mso-tab-count:1'>&nbsp;&nbsp; </span>buffer[<span class=SpellE>nextPos</span>]
= x<o:p></o:p></span></p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'><span
style='mso-tab-count:1'>&nbsp;&nbsp; </span><span class=SpellE>nextPos</span> =
(<span class=SpellE>nextPos</span> + 1) % MAX_SIZE<o:p></o:p></span></p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'>If
<b style='mso-bidi-font-weight:normal'>MAX_SIZE</b> = 100, then this code will
add 1, going from 99 back to 0.<span style="mso-spacerun: yes">&nbsp;
</span>The same trick works when decrementing index values:</p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-right-alt:solid windowtext .5pt;padding:0in;mso-padding-alt:0in 4.0pt 0in 4.0pt'><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'><span
style='mso-tab-count:1'>&nbsp;&nbsp; </span><span class=SpellE>nextPos</span> =
(<span class=SpellE>nextPos</span> - 1) % MAX_SIZE<o:p></o:p></span></p>

</div>

<div style='mso-element:para-border-div;border:solid windowtext 1.0pt;
border-top:none;mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt:
solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:0in 4.0pt 1.0pt 4.0pt;
margin-left:.25in;margin-right:.25in'>

<p class=MsoFooter style='tab-stops:.5in;border:none;mso-border-left-alt:solid windowtext .5pt;
mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
padding:0in;mso-padding-alt:0in 4.0pt 1.0pt 4.0pt'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

</div>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>The specification says that a user
program can open “terminal” just like any other file.<span style="mso-spacerun:
yes">&nbsp; </span>The file descriptor array associated with each process
points to <span class=SpellE><b style='mso-bidi-font-weight:normal'>OpenFiles</b></span>,
with a null value indicating that the given file descriptor is not an open
file.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Since the <b style='mso-bidi-font-weight:
normal'>Open</b> <span class=SpellE>syscall</span> must assign a new file
descriptor when called for “terminal” and the new file descriptor must point to
an <span class=SpellE><b style='mso-bidi-font-weight:normal'>OpenFile</b></span>,
you will need two kinds of <span class=SpellE><b style='mso-bidi-font-weight:
normal'>OpenFile</b></span>.<span style="mso-spacerun: yes">&nbsp; </span>One
kind is for files and one is for the terminal.<span style="mso-spacerun:
yes">&nbsp; </span>Later, we mention the possibility of implementing pipes, so
there are really three kinds of <span class=SpellE><b style='mso-bidi-font-weight:
normal'>OpenFiles</b></span>, but we’ll ignore pipes for now.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>The <b style='mso-bidi-font-weight:
normal'>kind</b> field in <span class=SpellE><b style='mso-bidi-font-weight:
normal'>OpenFile</b></span> will have one of the following values...</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:.25in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>enum</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'> FILE,
TERMINAL, PIPE<o:p></o:p></span></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Since there is only one terminal,
there will only be one <span class=SpellE><b style='mso-bidi-font-weight:normal'>OpenFile</b></span>
whose <b style='mso-bidi-font-weight:normal'>kind</b> is <b style='mso-bidi-font-weight:
normal'>TERMINAL</b>. <span style="mso-spacerun: yes">&nbsp;</span>Since there
is exactly one <span class=SpellE><b style='mso-bidi-font-weight:normal'>OpenFile</b></span>
for the terminal, you can pre-allocate this <span class=SpellE><b
style='mso-bidi-font-weight:normal'>OpenFile</b></span> object.<span
style="mso-spacerun: yes">&nbsp; </span>The logical place to do this is in <span
class=SpellE><b style='mso-bidi-font-weight:normal'>FileManager.Init</b></span>.<span
style="mso-spacerun: yes">&nbsp; </span>You can use the field called <span
class=SpellE><b style='mso-bidi-font-weight:normal'>serialTerminalFile</b></span>
in the <span class=SpellE><b style='mso-bidi-font-weight:normal'>fileManager</b></span>
object.<span style="mso-spacerun: yes">&nbsp; </span>In <b style='mso-bidi-font-weight:
normal'>Init</b>, you can create this unique <span class=SpellE><b
style='mso-bidi-font-weight:normal'>OpenFile</b></span> object, set its <b
style='mso-bidi-font-weight:normal'>kind</b> to <b style='mso-bidi-font-weight:
normal'>TERMINAL</b>, and make <span class=SpellE><b style='mso-bidi-font-weight:
normal'>serialTerminalFile</b></span> point to it.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>The <span class=SpellE><b
style='mso-bidi-font-weight:normal'>serialTerminalFile</b></span> is pretty
much a dummy place holder.<span style="mso-spacerun: yes">&nbsp; </span>None of
its other fields (<span class=SpellE><b style='mso-bidi-font-weight:normal'>currentPos</b></span>,
<span class=SpellE><b style='mso-bidi-font-weight:normal'>fcb</b></span>, <span
class=SpellE><b style='mso-bidi-font-weight:normal'>numberOfUsers</b></span>)
will be needed.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>The <b style='mso-bidi-font-weight:
normal'>Open</b> <span class=SpellE>syscall</span> handler requires very few
changes.<span style="mso-spacerun: yes">&nbsp; </span>Presumably in the
previous project, you began by copying the String argument (<b
style='mso-bidi-font-weight:normal'>filename</b>) from the virtual address
space to a kernel buffer (and aborting if problems).<span style="mso-spacerun:
yes">&nbsp; </span>Then you found the next free entry in the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>fileDescriptors</b></span>
array (and aborting if none).</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>At that point, you can check to see
if the <b style='mso-bidi-font-weight:normal'>filename</b> is equal to
“terminal” (see the <span class=SpellE><b style='mso-bidi-font-weight:normal'>StrEqual</b></span>
function from the <b style='mso-bidi-font-weight:normal'>System</b>
package).<span style="mso-spacerun: yes">&nbsp; </span>If so, you can just make
the <span class=SpellE><b style='mso-bidi-font-weight:normal'>fileDescriptor</b></span>
entry point to the <span class=SpellE><b style='mso-bidi-font-weight:normal'>OpenFile</b></span>
called <span class=SpellE><b style='mso-bidi-font-weight:normal'>serialTerminalFile</b></span>
and return.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>The <span class=SpellE>syscall</span>
handler for <b style='mso-bidi-font-weight:normal'>Close</b> is
straightforward.<span style="mso-spacerun: yes">&nbsp; </span>You’ll need to
reclaim the entry in the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>fileDescriptors</b></span> array, but that is all.<span
style="mso-spacerun: yes">&nbsp; </span>In particular, <span class=SpellE><b
style='mso-bidi-font-weight:normal'>FileManager.Close</b></span> should not do
anything if called on <span class=SpellE><b style='mso-bidi-font-weight:normal'>serialTerminalFile</b></span>.<span
style="mso-spacerun: yes">&nbsp; </span>Or perhaps you simply avoid ever
invoking <span class=SpellE><b style='mso-bidi-font-weight:normal'>FileManager.Close</b></span>
on the <span class=SpellE><b style='mso-bidi-font-weight:normal'>serialTerminalFile</b></span>.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Modifying the <b style='mso-bidi-font-weight:
normal'>Read</b> <span class=SpellE>syscall</span> handler will require a
little more effort.<span style="mso-spacerun: yes">&nbsp; </span>Presumably in
the last project your <span class=SpellE><b style='mso-bidi-font-weight:normal'>Handle_Sys_Read</b></span>
function began by checking the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>fileDesc</b></span> argument and locating the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>OpenFile</b></span> in question (and
aborting if problems).<span style="mso-spacerun: yes">&nbsp; </span>After
possibly dealing with a <span class=SpellE><b style='mso-bidi-font-weight:normal'>sizeInBytes</b></span>
of zero or less, you can insert code to see if you are dealing with the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>serialTerminalFile</b></span>
object, instead of a regular disk file.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter>If so, you’ll need to call <span class=SpellE><b
style='mso-bidi-font-weight:normal'>SerialDriver.GetChar</b></span> once to get
each character from the device.<span style="mso-spacerun: yes">&nbsp;
</span>We’ll leave the details to you, but perhaps you’ll use a single loop
which calls <span class=SpellE><b style='mso-bidi-font-weight:normal'>GetChar</b></span>
once per iteration.<span style="mso-spacerun: yes">&nbsp; </span>You’ll need to
keep track of the virtual address in which to store the next incoming character.<span
style="mso-spacerun: yes">&nbsp; </span>You’ll need to perform the
virtual-to-physical translation and check to make sure (1) that the virtual
page number is between 0 and the top legal page in the address space, (2) that
the page is valid (In this project all pages should be valid, since we haven’t
yet implemented paging to disk.), and (3) that the page is writable.<span
style="mso-spacerun: yes">&nbsp; </span>You’ll also need to set the page to
dirty and referenced, under the assumption that this would be needed if we were
swapping out pages.<span style="mso-spacerun: yes">&nbsp; </span>The <b
style='mso-bidi-font-weight:normal'>Read</b> <span class=SpellE>syscall</span>
must return the number of characters gotten from the input stream and moved
into the user-space buffer.<span style="mso-spacerun: yes">&nbsp; </span>The
reading will stop just after a newline (<b style='mso-bidi-font-weight:normal'>\n</b>)
character, but the user program will always get at least one character unless
there is an error with the arguments to the <span class=SpellE>syscall</span>,
or the end-of-file (EOF) character (control-D, ASCII value 0x04) is typed as a
first character on a read.<span style="mso-spacerun: yes">&nbsp; </span>When
EOF is typed, the read buffer should not be modified any further and the number
of characters read until before EOF was pressed should be returned. In
particular, if EOF is the first character on a read, the <b style='mso-bidi-font-weight:
normal'>Read</b> <span class=SpellE>syscall</span> should return 0 without
modifying its buffer.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>The modifications to the <b
style='mso-bidi-font-weight:normal'>Write</b> <span class=SpellE>syscall</span>
handler are quite similar.<span style="mso-spacerun: yes">&nbsp; </span>A
single loop can call <span class=SpellE><b style='mso-bidi-font-weight:normal'>SerialDriver.PutChar</b></span>
once per iteration.<span style="mso-spacerun: yes">&nbsp; </span>You’ll need to
have the same checks on the arguments and the same checks on the virtual
address pointer.<span style="mso-spacerun: yes">&nbsp; </span>Of course the
code should not set the page to dirty for write operation.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>The KEYBOARD-WAIT-TIME Simulation Constant</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>One of the simulation constants used by the emulator is</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>KEYBOARD_WAIT_TIME</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The value of this number tells the emulator how fast the
serial terminal device is.<span style="mso-spacerun: yes">&nbsp; </span>In
particular, it tells about how many instructions are to be executed between
serial interrupts.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>If, for some reason, your kernel does not retrieve an
incoming character from the terminal device fast enough, the character might
get lost when the next character comes in.<span style="mso-spacerun:
yes">&nbsp; </span>If this happens, the emulator (which checks for various
program errors) will notice that your OS is failing to get incoming characters
fast enough and will print out a message such as:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ERROR:
The serial input character &quot;g&quot; was not fetched in a timely way and
has been lost!</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>If you see this message, it indicates that your kernel has
an error.<span style="mso-spacerun: yes">&nbsp; </span>It is not getting the
incoming characters when it should.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The default value for KEYBOARD_WAIT_TIME (30,000) should be
more than enough to give your device driver time to process each character and
add it to the type-ahead buffer.<span style="mso-spacerun: yes">&nbsp;
</span>If you run into this error, the solution is to fix your kernel, not
modify the simulation constant!</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Of course the user program may fail to call <b
style='mso-bidi-font-weight:normal'>Write</b> fast enough to prevent the
type-ahead buffer from overflowing, but that is a different problem.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>Raw and Cooked Input</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Review the material in the document “The BLITZ Emulator”
regarding “raw” and “cooked” input.<span style="mso-spacerun: yes">&nbsp;
</span>You should play around with your program using both “raw” and “cooked”
mode.<span style="mso-spacerun: yes">&nbsp; </span>See the <b style='mso-bidi-font-weight:
normal'>raw</b> and <b style='mso-bidi-font-weight:normal'>cooked</b> commands
or the <b style='mso-bidi-font-weight:normal'>&#8211;raw</b> command line
option.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In cooked mode, which is the default, the host Unix system
will echo all characters as you type them.<span style="mso-spacerun:
yes">&nbsp; </span>Only after you hit the “enter” key will any characters get
delivered to the emulator and hence to the BLITZ serial device and to your BLITZ
kernel code.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In general, cooked mode is very nice because it lets the
user edit his/her input (using the backspace key) and relieves most Unix
programs from the burden of echoing keystrokes and dealing with the backspace
character.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>But be aware that with cooked mode, the BLITZ emulator may
get frozen, waiting for you to hit the enter key.<span style="mso-spacerun:
yes">&nbsp; </span>Or it may not.<span style="mso-spacerun: yes">&nbsp;
</span>Since this may be rather confusing, the BLITZ emulator will print a
message whenever it stops executing BLITZ code and is just waiting for user
input.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The emulator takes a command line parameter <b
style='mso-bidi-font-weight:normal'>&#8211;wait</b> that tells it what to do
when there is nothing more to do.<span style="mso-spacerun: yes">&nbsp;
</span>If you go back and look at the code in the thread scheduler,<b
style='mso-bidi-font-weight:normal'> </b>you’ll see that when a thread goes to
sleep and there are no remaining threads on the ready list, the “idle thread”
will execute the “wait” instruction, which suspends CPU execution and waits on
an interrupt.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In the past projects, we did not use the <b
style='mso-bidi-font-weight:normal'>&#8211;wait </b>option, so when a “wait”
instructions was executed, the emulator would print out the familiar message:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:.25in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:
Courier'>A 'wait' instruction was executed and no more interrupts are
scheduled... halting emulation!<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>With this project, the user is now able to type input so we
don’t want the emulator to just quit. We want the kernel to wait for incoming
events&#8212;keystrokes, in particular&#8212;wake up, service the interrupts,
and possibly resume execution in some user-level thread.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>So in this project you’ll need to use <b style='mso-bidi-font-weight:
normal'>&#8211;wait</b> on the command line, e.g., </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>% <b style='mso-bidi-font-weight:
normal'><u>blitz &#8211;g <span class=SpellE>os</span> &#8211;wait</u></b><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>or</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>% <b style='mso-bidi-font-weight:
normal'><u>blitz &#8211;g <span class=SpellE>os</span> &#8211;wait -raw</u></b><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Now, you’ll might see a different message:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoBodyTextIndent3><span style='font-size:11.0pt;mso-bidi-font-size:
10.0pt'>Execution suspended on 'wait' instruction; waiting for additional user
input<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>When you see this message, the emulator has stopped
executing instructions and is waiting for you to enter something.<span
style="mso-spacerun: yes">&nbsp; </span>This message only appears when the
emulator is running in cooked mode; in raw mode the emulator will just quietly
wait for the next keystroke.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>But now there is another problem: How can you stop the
emulator?<span style="mso-spacerun: yes">&nbsp; </span>The answer is by hitting
<b style='mso-bidi-font-weight:normal'>control-C</b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Hitting control-C once will suspend BLITZ instruction
emulation and put you back in the debugging command line loop.<span
style="mso-spacerun: yes">&nbsp; </span>You might see something like this:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>Beginning execution...<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>==================<span
style="mso-spacerun: yes">&nbsp; </span>KPL PROGRAM STARTING<span
style="mso-spacerun: yes">&nbsp; </span>==================<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>Initializing Thread Scheduler...<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>Initializing Process Manager...<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>Initializing Thread Manager...<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>Initializing Frame Manager...<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>*****<span style="mso-spacerun:
yes">&nbsp; </span>Control-C<span style="mso-spacerun: yes">&nbsp; </span>*****<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>Done!<span style="mso-spacerun:
yes">&nbsp; </span>The next instruction to execute will be:<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>026C5C: A3FFFFF8<span
style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span><span class=SpellE>bne</span><span
style="mso-spacerun: yes">&nbsp;&nbsp; </span>0xFFFFF8<span
style="mso-spacerun: yes">&nbsp;&nbsp; </span>! <span class=SpellE>targetAddr</span>
= _Label_168_2<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>&gt; <o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Control-C behaves a little funny when in “cooked” mode.<span
style="mso-spacerun: yes">&nbsp; </span>You may need to hit the ENTER/RETURN
key one or two times after hitting control-C before you see the “&gt;” prompt.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Hitting control-C twice in a row will terminate the BLITZ
emulator, which could be useful if the emulator has a bug.<span
style="mso-spacerun: yes">&nbsp; </span>(As if...!)</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<b style='mso-bidi-font-weight:normal'><u><span style='font-size:14.0pt;
mso-bidi-font-size:10.0pt;font-family:Times;mso-fareast-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";mso-ansi-language:EN-US;mso-fareast-language:
EN-US'><br clear=ALL style='page-break-before:always'>
</span></u></b>

<h3>Dealing With \n and \r</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In the <b style='mso-bidi-font-weight:normal'>Read</b> <span
class=SpellE>syscall</span> handler, you should replace any incoming<b
style='mso-bidi-font-weight:normal'> \r</b> characters by <b style='mso-bidi-font-weight:
normal'>\n</b> and treat the character just like the <b style='mso-bidi-font-weight:
normal'>\n </b>character (i.e., return from the <b style='mso-bidi-font-weight:
normal'>Read</b> <span class=SpellE>syscall</span> immediately without waiting
for additional characters).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Why?<span style="mso-spacerun: yes">&nbsp; </span>Because if
you are running the emulator in “raw” mode, some terminals will send a <b
style='mso-bidi-font-weight:normal'>\r </b>character whenever the key marked
“enter” or “return” is struck.<span style="mso-spacerun: yes">&nbsp; </span>By
substituting <b style='mso-bidi-font-weight:normal'>\n</b> for <b
style='mso-bidi-font-weight:normal'>\r</b>, the BLITZ user-level program will
never see a <b style='mso-bidi-font-weight:normal'>\r</b> character and can
work only with <b style='mso-bidi-font-weight:normal'>\n</b> characters.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In the <b style='mso-bidi-font-weight:normal'>Write</b> <span
class=SpellE>syscall</span> handler, whenever the user-level program tries to
send the <b style='mso-bidi-font-weight:normal'>\n</b> character to the serial
device, you should insert an additional call to send a <b style='mso-bidi-font-weight:
normal'>\r</b> as well.<span style="mso-spacerun: yes">&nbsp; </span>Perhaps
this code will work:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'>if <span class=SpellE>ch</span>
== '\n'<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:11.0pt;
mso-bidi-font-size:10.0pt;font-family:Courier'><span style="mso-spacerun:
yes">&nbsp; </span><span class=SpellE>serialDriver.PutChar</span> ('\r')<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>endIf</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span class=SpellE><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'>serialDriver.PutChar</span></span><span
style='font-size:11.0pt;mso-bidi-font-size:10.0pt;font-family:Courier'> (<span
class=SpellE>ch</span>)<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>This may be helpful in raw mode and should not have any
effect in cooked mode.<span style="mso-spacerun: yes">&nbsp; </span>You might
enjoy experimenting to see what your terminal does if this additional <b
style='mso-bidi-font-weight:normal'>\r</b> is left out.<span
style="mso-spacerun: yes">&nbsp; </span>(Try hitting control-J which will send
a <b style='mso-bidi-font-weight:normal'>\n</b> to your program.<span
style="mso-spacerun: yes">&nbsp; </span>Try hitting control-M which will send <b
style='mso-bidi-font-weight:normal'>\r</b> to your program.)</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Ideally, an OS would perform character editing and
everything associated with cooked mode in the terminal driver code.<span
style="mso-spacerun: yes">&nbsp; </span>Ideally, you would run your kernel
using the <b style='mso-bidi-font-weight:normal'>&#8211;raw </b>option in the
emulator and your driver would perform all echoing and character editing.<span
style="mso-spacerun: yes">&nbsp; </span>You might wish to experiment with such
modifications, but they are not part of the assignment.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>The “Print” Functions</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Up to now, you have been using functions such as <b
style='mso-bidi-font-weight:normal'>print</b>, <span class=SpellE><b
style='mso-bidi-font-weight:normal'>printInt</b></span>, <span class=SpellE><b
style='mso-bidi-font-weight:normal'>printIntVar</b></span>, and <span
class=SpellE><b style='mso-bidi-font-weight:normal'>printHex</b></span> to
assist in debugging your kernel code.<span style="mso-spacerun: yes">&nbsp;
</span>These functions do not work like normal I/O on any real computer.<span
style="mso-spacerun: yes">&nbsp; </span>Instead, these functions all make use
of a BLITZ instruction called “debug2” which would not be found on any real
computer.<span style="mso-spacerun: yes">&nbsp; </span>This magic little
instruction will cause some string or number to be immediately printed
out.<span style="mso-spacerun: yes">&nbsp; </span>There are no devices to
interface with, no delays, and no interrupts.<span style="mso-spacerun:
yes">&nbsp; </span>The output occurs “atomically” (i.e., all at once, with no
intervening instructions) which turns out to be <i style='mso-bidi-font-style:
normal'>very, very </i>useful in being able to read output from concurrent
programs.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In a real kernel, there is a similar mechanism for printing
to facilitate debugging.<span style="mso-spacerun: yes">&nbsp; </span>However,
the output is written to an in-memory buffer (rather than displayed), where it
can be examined (after the kernel has crashed) by some simpler program that
copies the “output” sitting in memory to somewhere where it can be read by a
human.<span style="mso-spacerun: yes">&nbsp; </span>A real nuisance, but
debugging kernel code is only for the strongest of programmers!</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In order for user-level programs to print, they should call <b
style='mso-bidi-font-weight:normal'>Write</b> on the serial terminal file.<span
style="mso-spacerun: yes">&nbsp; </span>Technically, any use of the “debug2”
instruction ought to be removed, but we have left it in.<span
style="mso-spacerun: yes">&nbsp; </span>The <b style='mso-bidi-font-weight:
normal'>print</b>, <span class=SpellE><b style='mso-bidi-font-weight:normal'>printInt</b></span>,
<span class=SpellE><b style='mso-bidi-font-weight:normal'>printIntVar</b></span>,
etc. functions are for debugging use only; they are not like anything found in
a real kernel.<span style="mso-spacerun: yes">&nbsp; </span>To print, a
user-level program needs to call a function (such as <span class=SpellE><b
style='mso-bidi-font-weight:normal'>printf</b></span> in C) which in turn will
invoke the <b style='mso-bidi-font-weight:normal'>Write</b> <span class=SpellE>syscall</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In our test programs, we will dispense with library
functions like <span class=SpellE><b style='mso-bidi-font-weight:normal'>printf</b></span>
which call <b style='mso-bidi-font-weight:normal'>Write</b> and just invoke <b
style='mso-bidi-font-weight:normal'>Write</b> directly.<span
style="mso-spacerun: yes">&nbsp; </span>Likewise, we will not get around to
implementing input functions like <span class=SpellE><b style='mso-bidi-font-weight:
normal'>scanf</b></span>, but will just invoke the <b style='mso-bidi-font-weight:
normal'>Read</b> <span class=SpellE>syscall</span> directly.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>The Shell Program</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>After completing this project, your kernel will have enough
functionality to support a Unix-like shell.<span style="mso-spacerun:
yes">&nbsp; </span>In particular, your kernel can support the following
features:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style="mso-spacerun: yes">&nbsp;</span>(1) Print a
prompt (such as %), read in the name of a program, and execute that program
loaded.<span style="mso-spacerun: yes">&nbsp; </span>For example:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>%
<span class=SpellE>prog</span><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The file called “<span class=SpellE>prog</span>” will be
executed with file descriptor 0 (<span class=SpellE>stdin</span>) pointing at
the terminal and file descriptor 1 (<span class=SpellE>stdout</span>) pointing
at the terminal.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>(2) Redirect input using the <b style='mso-bidi-font-weight:
normal'>&lt;</b> character, so that <span class=SpellE>stdin</span> comes from
a file.<span style="mso-spacerun: yes">&nbsp; </span>For example:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>%
cat &lt; <span class=SpellE>myFile</span><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>(3) Redirect <span class=SpellE>stdout</span> using the <b
style='mso-bidi-font-weight:normal'>&gt;</b> character, so that <span
class=SpellE>stdout</span> goes to a file.<span style="mso-spacerun:
yes">&nbsp; </span>For example:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>%
<span class=SpellE>ls</span> &gt; temp<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>(4) Deal with <span class=SpellE>stderr</span> (file
descriptor 2), perhaps using <b style='mso-bidi-font-weight:normal'>&gt;2</b>
for redirection.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>(5) Deal with starting jobs, without waiting for their
completion.<span style="mso-spacerun: yes">&nbsp; </span>For example:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>%
cat &lt; <span class=SpellE>myFile</span> &gt; temp &amp;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>[1]
723<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>%<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In this example, 723 is the process id.<span
style="mso-spacerun: yes">&nbsp; </span>We could also implement some other
job-control functions like <span class=SpellE><b style='mso-bidi-font-weight:
normal'>fg</b></span> and <b style='mso-bidi-font-weight:normal'>bg</b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>(7) Nested shell invocation, for example</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>%
<span class=SpellE>sh</span> &lt; script &gt; output<o:p></o:p></span></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>(8) We even have enough to implement some fancy (and complex)
features such as some shell programming constructs and command-line editing and
history.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>(9)<span style="mso-spacerun: yes">&nbsp; </span>If we
include the implementation of pipes (as discussed below), we could also add the
ability to pipe the output of one program to another program.<span
style="mso-spacerun: yes">&nbsp; </span>For example:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>%
cat | <span class=SpellE>wc</span><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>What we don’t have yet is any ability to pass command-line
arguments to the program, as in:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='font-size:11.0pt;mso-bidi-font-size:10.0pt;
font-family:Courier'><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>%
blitz &#8211;g <span class=SpellE>os</span> -raw<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>As part of the testing suite, we are providing a shell
program called <b style='mso-bidi-font-weight:normal'>sh</b>.<span
style="mso-spacerun: yes">&nbsp; </span>After finishing this project, see if
your kernel can execute this shell!</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>Pipes</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>As an extension (if you have enough time) you might consider
adding pipes to your kernel.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>You’ll need to add a new <span class=SpellE>syscall</span>, <b
style='mso-bidi-font-weight:normal'>Pipe</b>, which takes no arguments.<span
style="mso-spacerun: yes">&nbsp; </span>This <span class=SpellE>syscall</span>
will create a new pipe and return a file descriptor which refers to it.<span
style="mso-spacerun: yes">&nbsp; </span>It is much like the <b
style='mso-bidi-font-weight:normal'>Open</b> <span class=SpellE>syscall</span>.<span
style="mso-spacerun: yes">&nbsp; </span>It will need to allocate a new <span
class=SpellE><b style='mso-bidi-font-weight:normal'>OpenFile</b></span>
object.<span style="mso-spacerun: yes">&nbsp; </span>The <b style='mso-bidi-font-weight:
normal'>kind</b> of this new <span class=SpellE><b style='mso-bidi-font-weight:
normal'>OpenFile</b></span> object will be neither FILE nor TERMINAL, but
PIPE.<span style="mso-spacerun: yes">&nbsp; </span>You’ll need to modify the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>OpenFile</b></span> class
to add some sort of a buffer to it.<span style="mso-spacerun: yes">&nbsp;
</span>(How many bytes should the buffer be?<span style="mso-spacerun:
yes">&nbsp; </span>Only one byte is really necessary but more will allow
greater efficiency for programs using pipes when a producer outruns a
consumer.)</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>You’ll also need to add something to control the concurrency
and synchronization between producers and consumers.<span style="mso-spacerun:
yes">&nbsp; </span>(When the buffer is full, any process trying to write to it
must be suspended.<span style="mso-spacerun: yes">&nbsp; </span>When the buffer
is empty, any process trying to read from it must be suspended.)<span
style="mso-spacerun: yes">&nbsp; </span>The code in <b style='mso-bidi-font-weight:
normal'>Read</b> and <b style='mso-bidi-font-weight:normal'>Write</b> will be
quite similar to the code for dealing with the terminal file.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<h3>What to Hand In</h3>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <b style='mso-bidi-font-weight:normal'>p8</b> directory
contains a new user-level program called:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='tab-stops:.25in 1.5in'><span style='mso-tab-count:
1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b style='mso-bidi-font-weight:normal'>TestProgram5</b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Please modify your code to load <b style='mso-bidi-font-weight:
normal'>TestProgram5</b> as the initial process.<b style='mso-bidi-font-weight:
normal'><o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'>TestProgram5</b>
is structured like the previous test programs, but in addition to the
individual test functions, it also contains a menu-driven interface.<span
style="mso-spacerun: yes">&nbsp; </span>Once you get the serial device code
more-or-less functioning, you can change the <b style='mso-bidi-font-weight:
normal'>Main</b> function to invoke the <b style='mso-bidi-font-weight:normal'>Menu</b>
function.<span style="mso-spacerun: yes">&nbsp; </span>Then you can run the
various tests interactively from a menu, instead of recompiling each time.<span
style="mso-spacerun: yes">&nbsp; </span>This should make your life easier when
debugging and playing with raw and cooked modes.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>After you have finished coding and
debugging, please run each test (except <b style='mso-bidi-font-weight:normal'>Menu
</b>and <b style='mso-bidi-font-weight:normal'>Shell</b>) and hand in the
output from each test.<span style="mso-spacerun: yes">&nbsp; </span>A separate
document, called <span class=SpellE><b style='mso-bidi-font-weight:normal'>DesiredOutput.pdf</b></span>,
shows what the correct output should look like.<span style="mso-spacerun:
yes">&nbsp; </span>(Due to all the funny characters involved, a file created
with script may be a little confusing!)</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>For the tests named <span
class=SpellE><b style='mso-bidi-font-weight:normal'>KeyTest</b></span> and <span
class=SpellE><b style='mso-bidi-font-weight:normal'>EchoTest</b></span>, <span
class=SpellE><b style='mso-bidi-font-weight:normal'>LineEchoTest</b></span>,
don’t obsess on getting your output to exactly match the <span class=SpellE><b
style='mso-bidi-font-weight:normal'>DesiredOutput</b></span>; these tests are
more for you to play around with to understand how terminal I/O works.<span
style="mso-spacerun: yes">&nbsp; </span>For the other tests (<span
class=SpellE><b style='mso-bidi-font-weight:normal'>BasicSerialTest</b></span>,
<span class=SpellE><b style='mso-bidi-font-weight:normal'>EOFTest</b></span>, <span
class=SpellE><b style='mso-bidi-font-weight:normal'>OpenCloseTest</b></span>, <span
class=SpellE><b style='mso-bidi-font-weight:normal'>TerminalErrorTest</b></span>)
your output should match the <span class=SpellE><b style='mso-bidi-font-weight:
normal'>DesiredOutput</b></span> file.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Be sure to <i style='mso-bidi-font-style:
normal'><u>use the same code to execute all tests</u></i>.<span
style="mso-spacerun: yes">&nbsp; </span>Please hand in only one copy of your <span
class=SpellE><b style='mso-bidi-font-weight:normal'>Kernel.c</b></span> code
and do not hand in any output that was produced by a different version of your code!</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><i style='mso-bidi-font-style:normal'><u>Do
not change <b style='mso-bidi-font-weight:normal'>TestProgram5</b></u></i>,
except to uncomment one of the lines in the <b style='mso-bidi-font-weight:
normal'>main</b> function.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>During your testing, it may be
convenient to modify the tests as you try to see what is going on and get
things to work.<span style="mso-spacerun: yes">&nbsp; </span>Before you make
your final test runs, <i style='mso-bidi-font-style:normal'><u>please recopy <b
style='mso-bidi-font-weight:normal'>TestProgram5.c</b> from our directory</u></i>,
so that you get a fresh, unaltered version.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Please hand in hardcopy of your <span
class=SpellE><b style='mso-bidi-font-weight:normal'>Kernel.c</b></span>
code.<span style="mso-spacerun: yes">&nbsp; </span>You only need to hand in
those functions and methods that you created/modified.<span
style="mso-spacerun: yes">&nbsp; </span>This will probably include:</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>Handle_Sys_Open</span><o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>Handle_Sys_Close</span><o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>Handle_Sys_Read</span><o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>Handle_Sys_Write</span><o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>Handle_Sys_Seek</span><o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=SpellE>SerialInterruptHandler</span><o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>All
<span class=SpellE>SerialDriver</span> code<o:p></o:p></b></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Please circle or highlight the code
you have written for this project.</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>Please attempt to run the <span
class=SpellE><b style='mso-bidi-font-weight:normal'>sh</b></span> shell
program, but do not hand in any output from that.<span style="mso-spacerun:
yes">&nbsp; </span>Instead, please write directly on your output something
like...</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><i style='mso-bidi-font-style:normal'><span
style='font-size:16.0pt;mso-bidi-font-size:10.0pt;font-family:"Apple Chancery"'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The
shell program ran okay.<o:p></o:p></span></i></p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'>or</p>

<p class=MsoFooter style='tab-stops:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoFooter style='tab-stops:.5in'><i style='mso-bidi-font-style:normal'><span
style='font-size:16.0pt;mso-bidi-font-size:10.0pt;font-family:"Apple Chancery"'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>I
was unable to run the shell program.<o:p></o:p></span></i></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
